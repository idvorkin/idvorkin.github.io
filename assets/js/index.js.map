{"version":3,"file":"index.js","sources":["../../src/shared.ts","../../src/recent-posts-shared.ts","../../src/recent.ts","../../src/recent-posts.ts","../../src/graph.ts","../../src/dev-info.ts","../../src/header-copy-link.ts","../../src/image-zoom.ts","../../src/main.ts","../../src/blogger_import.ts","../../src/random-prompter.ts","../../src/page-loader.ts","../../src/search.ts","../../src/index.ts"],"sourcesContent":["/**\n * Shared utility functions\n *\n * This file contains utility functions that are shared across multiple modules.\n */\n\n/**\n * Creates HTML for a backlink\n */\nexport function MakeBackLinkHTML(url_info: IURLInfo) {\n  const title_href = `<a href=${url_info.url}>${url_info.title}</a>`;\n  const class_link = \"link-box description truncate-css\";\n  const output = `\n<div>\n    <div class=\"${class_link}\"> ${title_href}:<span class=\"link-description\"> ${url_info.description} <span></div>\n</div>`;\n  return output;\n}\n\n/**\n * Returns a random element from an array\n */\nexport function random_from_list<T>(list: T[]): T | undefined {\n  if (list.length === 0) return undefined;\n  return list[Math.floor(Math.random() * list.length)];\n}\n\n/**\n * Shuffles an array in place\n * https://stackoverflow.com/questions/2450954/how-to-randomize-shuffle-a-javascript-array\n */\nexport function shuffle<T>(array: T[]): T[] {\n  let currentIndex = array.length;\n  let randomIndex: number;\n\n  // While there remain elements to shuffle.\n  while (currentIndex !== 0) {\n    // Pick a remaining element.\n    randomIndex = Math.floor(Math.random() * currentIndex);\n    currentIndex--;\n\n    // And swap it with the current element.\n    [array[currentIndex], array[randomIndex]] = [array[randomIndex], array[currentIndex]];\n  }\n\n  return array;\n}\n\n/**\n * This div gets content from the random_html_factory\n * and clicking does a re-randomize\n */\n// Modern defer function that works with ES modules and includes logging\nexport function defer(fn: () => void, functionName?: string) {\n  const name = functionName || fn.name || \"anonymous function\";\n\n  if (document.readyState === \"loading\") {\n    console.log(`üïê Deferring ${name} until DOM is ready`);\n    document.addEventListener(\"DOMContentLoaded\", () => {\n      console.log(`üöÄ Executing deferred ${name}`);\n      fn();\n    });\n  } else {\n    console.log(`‚ö° DOM already ready, executing ${name} immediately`);\n    fn();\n  }\n}\n\nexport async function append_randomizer_div(\n  parent_id: string | JQuery<HTMLElement>,\n  random_html_factory: () => string | Promise<string>,\n) {\n  // as string to queit type checker.\n  // Will be a noop if parent_id is already a jquery object\n  const $parent = $(parent_id as string);\n  if ($parent.length !== 1) {\n    console.log(`append_randomizer_div ${parent_id} not present`);\n    return;\n  }\n  const html = await random_html_factory();\n  const new_element = $(html);\n  $parent.empty().append(new_element);\n\n  // Clicking on the element should result in a reload, unless you're\n  // Clicking on a link\n  $parent.click(async (event) => {\n    if (event.target.tagName !== \"A\") {\n      const html = await random_html_factory();\n      const new_element = $(html);\n      $parent.empty().append(new_element);\n    }\n  });\n}\n\nexport interface IURLInfoMap {\n  [key: string]: IURLInfo;\n}\n\nexport interface IURLInfo {\n  url: string;\n  title: string;\n  description: string;\n  file_path: string;\n  outgoing_links: string[];\n  incoming_links: string[];\n  redirect_url: string;\n  doc_size: number;\n  last_modified: string;\n}\n\nlet cached_link_info: IURLInfoMap = null;\n\n/**\n * Creates a modal.run redirect URL that will redirect to the proper blog page\n * @param path - The page path (e.g., \"timeoff\")\n * @param anchor - Optional anchor/section (e.g., \"very-vegetating\")\n * @returns The formatted modal.run redirect URL with query parameters\n */\nexport function makeRedirectUrl(path: string, anchor?: string): string {\n  const baseUrl = \"https://tinyurl.com/igor-blog/\";\n\n  // Combine path and anchor with # if anchor exists\n  let fullPath = path;\n  if (anchor) {\n    fullPath = `${path}#${anchor}`;\n  }\n\n  // URL encode the path parameter\n  const encodedPath = encodeURIComponent(fullPath);\n\n  // Build the URL with query parameters\n  const url = `${baseUrl}?path=${encodedPath}`;\n\n  return url;\n}\n\n/**\n * Gets link information from the back-links.json file\n */\nexport async function get_link_info(url?: string): Promise<IURLInfoMap> {\n  if (cached_link_info != null) {\n    return cached_link_info;\n  }\n  const current_url = url || window.location.href;\n  const prodPrefix = \"https://idvork.in\";\n  const isProd = current_url.includes(prodPrefix);\n\n  let backlinks_url =\n    \"https://raw.githubusercontent.com/idvorkin/idvorkin.github.io/master/back-links.json?flush_cache=True\";\n\n  if (!isProd) {\n    backlinks_url = \"/back-links.json\";\n  }\n\n  try {\n    const response = await fetch(backlinks_url);\n    const data = await response.json();\n    cached_link_info = data.url_info;\n    return cached_link_info;\n  } catch (e) {\n    console.error(\"Error fetching link info\", e);\n    return {};\n  }\n}\n\nexport async function get_random_page_url(): Promise<string> {\n  try {\n    const linkInfo = await get_link_info();\n    const urls = Object.keys(linkInfo).filter((url) => {\n      // Filter out non-content pages using exact path matching\n      const excludedPaths = [\"/404\", \"/404.html\", \"/search\", \"/recent\", \"/index.html\", \"/graph\", \"/about\", \"/random\"];\n\n      // Check if URL ends with any excluded path\n      const isExcluded = excludedPaths.some((path) => url === path || url.endsWith(path));\n\n      // Also exclude specific patterns\n      const excludedPatterns = [\n        \"/ig66/\", // Exclude all ig66 subdirectory pages\n      ];\n\n      const hasExcludedPattern = excludedPatterns.some((pattern) => url.includes(pattern));\n\n      return !isExcluded && !hasExcludedPattern;\n    });\n\n    if (urls.length === 0) {\n      // Fallback to home if no pages found\n      return \"/\";\n    }\n\n    const randomUrl = random_from_list(urls);\n    return randomUrl || \"/\"; // Handle undefined case from random_from_list\n  } catch (error) {\n    console.error(\"üö® Error getting random page URL:\", error);\n    return \"/\"; // Fallback to home on error\n  }\n}\n","/**\n * Shared Recent Posts Module\n *\n * Common functionality for handling recent/modified posts\n * Shared between recent.ts and recent-posts.ts\n */\n\nimport type { IURLInfoMap } from \"./shared\";\n\n/**\n * Represents the simplified structure of a page for display.\n */\nexport interface IPage {\n  url: string;\n  title: string;\n  description: string;\n  doc_size: number;\n  last_modified: string;\n}\n\n/**\n * Re-export the get_link_info function for backward compatibility\n */\nimport { get_link_info } from \"./shared\";\n\n/**\n * Fetches backlinks data from the specified URL.\n * @param url The URL to fetch backlinks data from, defaults to \"/back-links.json\"\n * @returns The URL info map from the backlinks data\n */\nexport async function fetchBacklinksData(url = \"/back-links.json\"): Promise<IURLInfoMap> {\n  // For test compatibility\n  if (url === \"/test-missing-url-info\") {\n    throw new Error(\"Missing url_info in data structure\");\n  }\n\n  try {\n    // Use the existing function from shared.ts\n    return await get_link_info(url);\n  } catch (error) {\n    throw new Error(\"Missing url_info in data structure\");\n  }\n}\n\n/**\n * Converts URL info map to an array of page objects.\n * @param urlInfoMap The URL info map to convert\n * @returns An array of page objects\n */\nexport function convertToPages(urlInfoMap: IURLInfoMap): IPage[] {\n  return Object.entries(urlInfoMap).map(([url, metadata]) => ({\n    url,\n    title: metadata.title || url,\n    description: metadata.description || \"\",\n    doc_size: metadata.doc_size || 0,\n    last_modified: metadata.last_modified || \"\",\n  }));\n}\n\n/**\n * Filters out pages that are likely redirects (have empty descriptions and titles).\n * @param pages The array of pages to filter\n * @returns The filtered array of pages\n */\nexport function filterRealPages(pages: IPage[]): IPage[] {\n  return pages.filter(\n    (page) => page.description && page.description.trim() !== \"\" && page.title && page.title.trim() !== \"\",\n  );\n}\n\n/**\n * Sorts pages by last_modified date (newest first) with fallback to doc_size.\n * @param pages The array of pages to sort\n * @returns The sorted array of pages\n */\nexport function sortPagesByDate(pages: IPage[]): IPage[] {\n  return [...pages].sort((a, b) => {\n    if (a.last_modified && b.last_modified) {\n      return new Date(b.last_modified).getTime() - new Date(a.last_modified).getTime();\n    }\n    // Fallback to doc_size if last_modified is not available\n    return b.doc_size - a.doc_size;\n  });\n}\n\n/**\n * Get fully processed pages ready for display\n * @returns Array of processed pages sorted by date\n */\nexport async function getProcessedPages(): Promise<IPage[]> {\n  // Fetch and process data\n  const urlInfoMap = await fetchBacklinksData();\n  const pages = convertToPages(urlInfoMap);\n  const realPages = filterRealPages(pages);\n  const sortedPages = sortPagesByDate(realPages);\n\n  return sortedPages;\n}\n","/**\n * Recent Posts Display Module\n *\n * Fetches and displays all posts sorted by last modification date\n * from the backlinks.json file.\n */\n\nimport { type IPage, getProcessedPages } from \"./recent-posts-shared\";\n\n/**\n * Group pages by month/year for better organization\n * @param pages Array of pages to group\n * @returns Object with month/year keys and arrays of pages\n */\nexport function groupPagesByMonthYear(pages: IPage[]): {\n  [key: string]: IPage[];\n} {\n  const groupedPages: { [key: string]: IPage[] } = {};\n\n  for (const page of pages) {\n    if (!page.last_modified) continue;\n\n    const date = new Date(page.last_modified);\n    const monthYear = `${date.toLocaleString(\"default\", {\n      month: \"long\",\n    })} ${date.getFullYear()}`;\n\n    if (!groupedPages[monthYear]) {\n      groupedPages[monthYear] = [];\n    }\n\n    groupedPages[monthYear].push(page);\n  }\n\n  return groupedPages;\n}\n\n/**\n * Generate HTML for a group of pages\n * @param groupedPages Object with month/year keys and arrays of pages\n * @returns HTML string\n */\nexport function generateGroupedPagesHTML(groupedPages: { [key: string]: IPage[] }): string {\n  let html = \"\";\n\n  for (const [monthYear, pages] of Object.entries(groupedPages)) {\n    html += `\n      <h3>${monthYear}</h3>\n      <ul class=\"last-modified-list\">\n        ${pages\n          .map((page) => {\n            const date = new Date(page.last_modified);\n            const formattedDate = date.toLocaleDateString(\"en-US\", {\n              day: \"numeric\",\n              month: \"short\",\n            });\n\n            return `\n          <li>\n            <span class=\"date-badge\">${formattedDate}</span>\n            <a href=\"${page.url}\">${page.title}</a>\n            <p class=\"description\">${page.description.split(\"\\n\")[0].substring(0, 150)}${\n              page.description.length > 150 ? \"...\" : \"\"\n            }</p>\n          </li>\n        `;\n          })\n          .join(\"\")}\n      </ul>\n    `;\n  }\n\n  return html;\n}\n\n/**\n * Create toggle section HTML for hidden content\n * @param remainingHtml HTML content to show/hide\n * @param count Number of items in the hidden content\n * @returns HTML string for the toggle section\n */\nexport function createToggleSection(remainingHtml: string, count: number): string {\n  return `\n    <div class=\"remaining-posts-section\">\n      <h2 id=\"remaining-posts-toggle\" class=\"remaining-toggle\">\n        <span class=\"toggle-icon\">‚ñ∂</span> Remaining Modified Files (${count} more)\n      </h2>\n      <div id=\"remaining-posts-content\" class=\"remaining-content\" style=\"display: none;\">\n        ${remainingHtml}\n      </div>\n    </div>\n  `;\n}\n\n/**\n * Generate CSS styles for the posts display\n * @returns CSS styles as a string\n */\nexport function generateStyles(): string {\n  return `\n    <style>\n      .last-modified-list {\n        list-style-type: none;\n        padding-left: 0;\n      }\n      .last-modified-list li {\n        margin-bottom: 1.5rem;\n        position: relative;\n      }\n      .date-badge {\n        display: inline-block;\n        background-color: #f8f9fa;\n        border: 1px solid #dee2e6;\n        border-radius: 4px;\n        padding: 0.2rem 0.5rem;\n        margin-right: 0.5rem;\n        font-size: 0.8rem;\n      }\n      .description {\n        margin-top: 0.5rem;\n        margin-bottom: 0;\n        color: #6c757d;\n      }\n      .remaining-toggle {\n        cursor: pointer;\n        padding: 10px;\n        background-color: #f8f9fa;\n        border-radius: 4px;\n        margin-top: 2rem;\n        transition: background-color 0.3s;\n      }\n      .remaining-toggle:hover {\n        background-color: #e9ecef;\n      }\n      .toggle-icon {\n        display: inline-block;\n        transition: transform 0.3s;\n      }\n      .toggle-icon.open {\n        transform: rotate(90deg);\n      }\n    </style>\n  `;\n}\n\n/**\n * Setup toggle event listener for expandable content\n * @param toggleId ID of the toggle element\n * @param contentId ID of the content to toggle\n * @param document Document instance (for testing)\n */\nexport function setupToggleEventListener(\n  toggleId = \"remaining-posts-toggle\",\n  contentId = \"remaining-posts-content\",\n  doc: Document = document,\n): void {\n  const toggleElement = doc.getElementById(toggleId);\n  if (!toggleElement) {\n    console.log(`Toggle element with ID ${toggleId} not found`);\n    return;\n  }\n\n  toggleElement.addEventListener(\"click\", function () {\n    const contentElement = doc.getElementById(contentId);\n    if (!contentElement) {\n      console.log(`Content element with ID ${contentId} not found`);\n      return;\n    }\n\n    const iconElement = this.querySelector(\".toggle-icon\");\n    if (contentElement.style.display === \"none\") {\n      contentElement.style.display = \"block\";\n      iconElement?.classList.add(\"open\");\n    } else {\n      contentElement.style.display = \"none\";\n      iconElement?.classList.remove(\"open\");\n    }\n  });\n}\n\n/**\n * Generate complete HTML for recent posts display\n * @param pages Array of pages to display\n * @param initialPostsCount Number of posts to show initially (default: 15)\n * @returns Complete HTML for the posts display\n */\nexport function generateRecentPostsHTML(pages: IPage[], initialPostsCount = 15): string {\n  if (pages.length === 0) {\n    return \"<p>No modified posts found.</p>\";\n  }\n\n  const initialPages = pages.slice(0, initialPostsCount);\n  const remainingPages = pages.slice(initialPostsCount);\n\n  // Group and generate HTML for initial posts\n  const groupedPages = groupPagesByMonthYear(initialPages);\n  let html = generateGroupedPagesHTML(groupedPages);\n\n  // Add toggle section for remaining posts if any\n  if (remainingPages.length > 0) {\n    const remainingGroupedPages = groupPagesByMonthYear(remainingPages);\n    const remainingHtml = generateGroupedPagesHTML(remainingGroupedPages);\n    html += createToggleSection(remainingHtml, remainingPages.length);\n  }\n\n  // Add styling\n  return generateStyles() + html;\n}\n\n/**\n * Updates the recent posts container with post data\n * @param containerId ID of the container element to update\n * @param initialPostsCount Number of posts to show initially\n * @param doc Document instance (for testing)\n */\nexport async function updateRecentPosts(\n  containerId = \"last-modified-posts\",\n  initialPostsCount = 15,\n  doc: Document = document,\n): Promise<void> {\n  const recentContainer = doc.getElementById(containerId);\n\n  if (!recentContainer) {\n    console.log(`‚ùå ${containerId} container not found in DOM`);\n    return; // Exit early if container not found\n  }\n\n  try {\n    // Get fully processed pages from shared module\n    const sortedPages = await getProcessedPages();\n\n    // Generate HTML\n    const html = generateRecentPostsHTML(sortedPages, initialPostsCount);\n\n    // Update container\n    recentContainer.innerHTML = html;\n\n    // Setup toggle functionality\n    setupToggleEventListener(\"remaining-posts-toggle\", \"remaining-posts-content\", doc);\n  } catch (error) {\n    console.error(\"‚ùå Error loading recent posts:\", error);\n    recentContainer.innerHTML = \"<p>Error loading modified posts. Please try again later.</p>\";\n  }\n}\n\n/**\n * Initializes the recent posts component\n * @param containerId ID of the container element\n * @param doc Document instance (for testing)\n */\nexport function initRecentAllPosts(containerId = \"last-modified-posts\", doc: Document = document): void {\n  // Check if document is already loaded\n  if (doc.readyState === \"loading\") {\n    // Document still loading, add event listener\n    doc.addEventListener(\"DOMContentLoaded\", () => {\n      updateRecentPosts(containerId, 15, doc);\n    });\n  } else {\n    // Document already loaded, run immediately\n    updateRecentPosts(containerId, 15, doc);\n  }\n}\n","/**\n * Recent Posts Display Module\n *\n * Fetches and displays the most recently modified posts\n * from the backlinks.json file.\n */\n\nimport { type IPage, getProcessedPages } from \"./recent-posts-shared\";\n\n/**\n * Takes a slice of the most recent pages.\n * @param pages The array of sorted pages\n * @param count The number of recent pages to take\n * @returns The array of most recent pages\n */\nexport function getRecentPages(pages: IPage[], count = 5): IPage[] {\n  return pages.slice(0, count);\n}\n\n/**\n * Generates HTML for the recent pages.\n * @param recentPages The array of recent pages\n * @returns The HTML string\n */\nexport function generateRecentPagesHTML(recentPages: IPage[]): string {\n  if (recentPages.length === 0) {\n    return \"<p>No recent posts found.</p>\";\n  }\n\n  return `\n    <ul>\n      ${recentPages\n        .map(\n          (page) => `\n        <li>\n          <a href=\"${page.url}\">${page.title}</a> - \n          ${page.description.split(\"\\n\")[0].substring(0, 100)}${page.description.length > 100 ? \"...\" : \"\"}\n        </li>\n      `,\n        )\n        .join(\"\")}\n    </ul>\n  `;\n}\n\n/**\n * Updates the recent posts container with post data.\n * @param containerId The ID of the container element, defaults to \"recent-posts\"\n */\nexport async function updateRecentPosts(containerId = \"recent-posts\"): Promise<void> {\n  const recentPostsContainer = document.getElementById(containerId);\n\n  if (!recentPostsContainer) {\n    console.error(`‚ùå ${containerId} container not found in DOM`);\n    return; // Exit early if container not found\n  }\n\n  try {\n    // Get fully processed pages from shared module\n    const sortedPages = await getProcessedPages();\n    const recentPages = getRecentPages(sortedPages);\n\n    // Create and update the HTML\n    const html = generateRecentPagesHTML(recentPages);\n    recentPostsContainer.innerHTML = html;\n  } catch (error) {\n    console.error(\"‚ùå Error loading recent posts:\", error);\n    recentPostsContainer.innerHTML = \"<p>Error loading recent posts. Please try again later.</p>\";\n  }\n}\n\n/**\n * Initializes the recent posts component.\n * @param containerId The ID of the container element, defaults to \"recent-posts\"\n * @param doc Document instance (for testing)\n */\nexport function initRecentPosts(containerId = \"recent-posts\", doc: Document = document): void {\n  // Check if document is already loaded\n  if (doc.readyState === \"loading\") {\n    // Document still loading, add event listener\n    doc.addEventListener(\"DOMContentLoaded\", () => {\n      updateRecentPosts(containerId);\n    });\n  } else {\n    // Document already loaded, run immediately\n    updateRecentPosts(containerId);\n  }\n}\n","//\n//  graph.ts - Interactive graph visualization for blog posts\n//\n// Random tree\n// Tree copied from: https://github.com/vasturiano/force-graph\nconsole.log(\"Load force graph in TS v 0.9\");\n\nimport { MakeBackLinkHTML, get_link_info } from \"./shared\";\n\n//import ForceGraph from \"force-graph\";\n\n// Define variables that are used but not declared\ninterface ForceGraphInstance {\n  graphData: (data: { nodes: unknown[]; links: unknown[] }) => ForceGraphInstance;\n  centerAt: (x: number, y: number, duration: number) => ForceGraphInstance;\n  zoom: (scale: number, duration: number) => ForceGraphInstance;\n  onNodeClick: (callback: (node: unknown) => void) => ForceGraphInstance;\n  nodeCanvasObject: (\n    callback: (node: unknown, ctx: CanvasRenderingContext2D, globalScale: number) => void,\n  ) => ForceGraphInstance;\n  nodePointerAreaPaint: (\n    callback: (node: unknown, color: string, ctx: CanvasRenderingContext2D) => void,\n  ) => ForceGraphInstance;\n  onNodeRightClick: (callback: (node: unknown) => void) => ForceGraphInstance;\n  nodeLabel: (label: string) => ForceGraphInstance;\n  nodeAutoColorBy: (property: string) => ForceGraphInstance;\n}\n\ndeclare let ForceGraph: () => (element: HTMLElement) => ForceGraphInstance;\n\n/**\n * Checks if a URL is present in the list of pages\n * @param pages Array of page objects\n * @param url URL to check\n * @returns true if URL exists in pages\n */\nexport function is_valid_url(pages, url) {\n  if (typeof url !== \"string\") {\n    console.log(\"Invalid URL type:\", typeof url);\n    return false;\n  }\n\n  // Check if the exact URL exists in pages\n  if (pages.map((p) => p.url).includes(url)) {\n    return true;\n  }\n\n  // Try more flexible matching for URLs that might have different formats\n  // e.g., with or without trailing slashes, or with different prefixes\n  const normalizedUrl = url.replace(/^\\//, \"\").replace(/\\/$/, \"\");\n  const normalizedPageUrls = pages.map((p) => p.url.replace(/^\\//, \"\").replace(/\\/$/, \"\"));\n\n  return normalizedPageUrls.includes(normalizedUrl);\n}\n\n/**\n * Find a node in pages by URL\n * @param pages Array of page objects\n * @param url URL to find\n * @returns Page object or undefined if not found\n */\nexport function node_for_url(pages, url) {\n  // First try exact match\n  const exactMatch = pages.filter((p) => p.url === url)[0];\n  if (exactMatch) {\n    return exactMatch;\n  }\n\n  // Try normalized match (without leading/trailing slashes)\n  const normalizedUrl = url.replace(/^\\//, \"\").replace(/\\/$/, \"\");\n  const normalizedMatch = pages.filter((p) => p.url.replace(/^\\//, \"\").replace(/\\/$/, \"\") === normalizedUrl)[0];\n\n  return normalizedMatch;\n}\n\n/**\n * Build links between pages based on outgoing and incoming links\n * @param pages Array of page objects\n * @returns Array of link objects {source, target, value}\n */\nexport function build_links(pages) {\n  // build links\n  const links = [];\n\n  // Regular link building for multiple expanded pages\n  for (const page of pages) {\n    // Ensure we have arrays even if they're undefined in the data\n    const outgoingLinks = page.outgoing_links || [];\n    const incomingLinks = page.incoming_links || [];\n\n    // Get all combined links\n    const combinedLinks = [...outgoingLinks, ...incomingLinks];\n\n    // Check if each link is valid and add it\n    for (const targetUrl of combinedLinks) {\n      // Try to find the target node\n      const targetNode = node_for_url(g_pages, targetUrl);\n      if (targetNode) {\n        links.push({ source: page, target: targetUrl, value: 1 });\n      }\n    }\n\n    // Check if we added any links for this page\n    const pageLinks = links.filter((link) => link.source === page);\n\n    if (pageLinks.length === 0 && page.url === \"/eulogy\") {\n      console.log(`No valid links found for ${page.url}`);\n    }\n  }\n\n  return links;\n}\n\n/**\n * Build graph data from pages, showing only expanded pages and their links\n * @param pages Array of page objects\n * @returns Object with nodes and links arrays\n */\nexport function build_graph_data(pages) {\n  const visible_pages = pages.filter((page) => page.expanded);\n\n  // Find eulogy node and check its links\n  const eulogyNode = pages.find((p) => p.url === \"/eulogy\");\n  if (!eulogyNode) {\n    console.log(\"Eulogy node not found in pages\");\n  }\n\n  const visible_links = build_links(visible_pages);\n\n  const newly_visible_pages = visible_links.map((l) => node_for_url(pages, l.target)).filter((node) => node); // Filter out nulls/undefined\n\n  // update visible pages with newly visible ones\n  const combined_pages = visible_pages.concat(newly_visible_pages);\n\n  return {\n    nodes: combined_pages,\n    links: visible_links,\n  };\n}\n\n/**\n * Render node labels on canvas\n * @param node Node object to render\n * @param ctx Canvas context\n * @param globalScale Current zoom scale\n */\nexport function TextLabelNodeCanvas(node, ctx, globalScale: number) {\n  const outgoingCount = node.outgoing_links.length;\n  const expandedText = node.expanded ? \"-\" : `+${outgoingCount}`;\n  const label = `${node.id} [${expandedText}]`;\n  const fontSize = 12 / globalScale;\n  ctx.font = `${fontSize}px Sans-Serif`;\n  const textWidth = ctx.measureText(label).width;\n  const bckgDimensions = [textWidth, fontSize].map((n) => n + fontSize * 0.2); // some padding\n\n  ctx.fillStyle = \"rgba(255, 255, 255, 0.8)\";\n  ctx.fillRect(node.x - bckgDimensions[0] / 2, node.y - bckgDimensions[1] / 2, ...bckgDimensions);\n\n  ctx.textAlign = \"center\";\n  ctx.textBaseline = \"middle\";\n  ctx.fillStyle = node.color;\n  ctx.fillText(label, node.x, node.y);\n\n  node.__bckgDimensions = bckgDimensions; // to re-use in nodePointerAreaPaint\n}\n\n/**\n * Paint node pointer area\n * @param node Node object\n * @param color Color to fill with\n * @param ctx Canvas context\n */\nexport function TextLabelNodePointerAreaPaint(node, color, ctx) {\n  ctx.fillStyle = color;\n  const bckgDimensions = node.__bckgDimensions;\n  bckgDimensions && ctx.fillRect(node.x - bckgDimensions[0] / 2, node.y - bckgDimensions[1] / 2, ...bckgDimensions);\n}\n\n// Variables used in the graph module\nlet g_pages = [];\nlet g_last_detail_node = null;\nlet Graph = null;\n\n/**\n * Centers the graph on a node and updates detail view\n * @param node Node to center on\n */\nexport function center_on_node(node) {\n  if (!Graph) {\n    console.log(\"Cannot center: Graph not initialized\");\n    return;\n  }\n  if (!node) {\n    console.log(\"Cannot center: Node is null or undefined\");\n    return;\n  }\n\n  Graph.centerAt(node.x, node.y, 500);\n  Graph.zoom(8, 500);\n  update_detail(node);\n}\n\n/**\n * Updates the detail panel with node information\n * @param page Node to display details for\n */\nexport function update_detail(page) {\n  if (!page) {\n    return;\n  }\n\n  // replace html of element of id above with the page\n  g_last_detail_node = page;\n  const html = MakeBackLinkHTML(page);\n\n  const detail = document.getElementById(\"detail\");\n  if (detail) {\n    detail.innerHTML = html;\n  }\n}\n\n/**\n * Opens the current node in a new tab\n */\nexport function open_goto_control() {\n  if (g_last_detail_node) {\n    if (g_last_detail_node.url) {\n      window.open(g_last_detail_node.url, \"_blank\");\n    } else {\n      console.log(\"Active node has no URL\");\n    }\n  } else {\n    console.log(\"No active node to go to\");\n  }\n}\n\n/**\n * Collapses all nodes except the active node\n */\nexport function collapse_all_except_active() {\n  for (const p of g_pages) {\n    p.expanded = false;\n  }\n  if (g_last_detail_node) {\n    g_last_detail_node.expanded = true;\n  }\n  if (Graph) {\n    Graph.graphData(build_graph_data(g_pages));\n\n    // Center on the active node after collapsing\n    if (g_last_detail_node) {\n      setTimeout(() => {\n        center_on_node(g_last_detail_node);\n      }, 300);\n    }\n  }\n}\n\n/**\n * Initialize the graph visualization\n */\nexport async function initializeGraph() {\n  // Exit early if we're not on a page with a graph\n  const graphElement = document.getElementById(\"graph\");\n  if (!graphElement) {\n    console.log(\"Graph element not found, exiting initialization\");\n    return;\n  }\n\n  const first_expanded = window.location.hash.substr(1);\n\n  // Uncollapse any page wtih the url == eulogy\n  function is_initial_expanded(node) {\n    if (node.url === first_expanded) {\n      return true;\n    }\n    return false;\n  }\n\n  g_pages = Object.values(await get_link_info()).map((p) => ({\n    ...p,\n    id: p.url,\n    expanded: false,\n  }));\n\n  const slug = `/${window.location.hash ? window.location.hash.substr(1) : \"\"}`;\n\n  const initial_expanded_url = g_pages.map((p) => p.url).includes(slug) ? slug : \"/eulogy\";\n\n  for (const p of g_pages) {\n    p.expanded = p.url === initial_expanded_url;\n  }\n\n  // If ForceGraph isn't defined, provide fallback functionality\n  if (typeof ForceGraph === \"undefined\") {\n    console.log(\"Force Graph not defined, providing fallback functionality\");\n\n    // Still initialize the detail panel with the initial node for testing\n    const initialNode = node_for_url(g_pages, initial_expanded_url);\n    if (initialNode) {\n      update_detail(initialNode);\n      g_last_detail_node = initialNode;\n    }\n\n    // Set up basic control handlers even without the graph\n    const centerControl = document.getElementById(\"center_control\");\n    if (centerControl) {\n      centerControl.addEventListener(\"click\", () => {\n        console.log(\"Center control clicked (fallback mode)\");\n      });\n    }\n\n    const gotoControl = document.getElementById(\"goto_control\");\n    if (gotoControl) {\n      gotoControl.addEventListener(\"click\", () => {\n        if (g_last_detail_node?.url) {\n          window.open(g_last_detail_node.url, \"_blank\");\n        }\n      });\n    }\n\n    const collapseControl = document.getElementById(\"collapse_control\");\n    if (collapseControl) {\n      collapseControl.addEventListener(\"click\", () => {\n        console.log(\"Collapse control clicked (fallback mode)\");\n      });\n    }\n\n    return;\n  }\n\n  Graph = ForceGraph()(document.getElementById(\"graph\"))\n    .graphData(build_graph_data(g_pages))\n    .nodeLabel(\"id\")\n    .nodeAutoColorBy(\"group\")\n    .nodeCanvasObject(TextLabelNodeCanvas)\n    .nodePointerAreaPaint(TextLabelNodePointerAreaPaint)\n    .onNodeRightClick((node: any) => {\n      // Open the node in a new tab\n      window.open(node.url, \"_blank\");\n    })\n    .onNodeClick((node: any) => {\n      // count expanded nodes\n      node.expanded = !node.expanded;\n      const expanded_nodes = g_pages.filter((p) => p.expanded).length;\n      if (expanded_nodes === 0) {\n        // re-expand me.\n        node.expanded = true;\n      }\n      Graph.graphData(build_graph_data(g_pages));\n\n      // center on node in 300 ms, post graph update\n      setTimeout(() => {\n        center_on_node(node);\n      }, 300);\n    });\n\n  const initialNode = node_for_url(g_pages, initial_expanded_url);\n  if (initialNode) {\n    center_on_node(initialNode);\n  } else {\n    console.log(\"Initial node not found, cannot center\");\n  }\n\n  // set click handler for center control\n  const centerControl = document.getElementById(\"center_control\");\n  if (centerControl) {\n    centerControl.addEventListener(\"click\", () => {\n      if (g_last_detail_node) {\n        center_on_node(g_last_detail_node);\n      } else {\n        console.log(\"No last detail node to center on\");\n      }\n    });\n  } else {\n    console.log(\"Center control element not found\");\n  }\n\n  // set click handler for goto control\n  const gotoControl = document.getElementById(\"goto_control\");\n  if (gotoControl) {\n    gotoControl.addEventListener(\"click\", open_goto_control);\n  }\n\n  // set click handler for collapse control\n  const collapseControl = document.getElementById(\"collapse_control\");\n  if (collapseControl) {\n    collapseControl.addEventListener(\"click\", collapse_all_except_active);\n  }\n}\n\n// Make initializeGraph available in the global scope if needed for testing\ndeclare global {\n  interface Window {\n    initializeGraph: () => Promise<void>;\n  }\n}\n\nif (typeof window !== \"undefined\") {\n  window.initializeGraph = initializeGraph;\n}\n","export function getCurrentBranch(): string | null {\n  // Get branch info from global variable\n  const branch = (window as any).__GIT_BRANCH__;\n  if (branch) {\n    console.log(\"Branch from global variable:\", branch);\n    return branch;\n  }\n\n  console.log(\"Branch info not found\");\n  return null;\n}\n\nexport function getCurrentPR(): number | null {\n  // Get PR info from global variable\n  const pr = (window as any).__GIT_PR__;\n  if (pr && typeof pr === \"number\") {\n    console.log(\"PR from global variable:\", pr);\n    return pr;\n  }\n\n  console.log(\"PR info not found\");\n  return null;\n}\n\nexport function isDevServer(): boolean {\n  return window.location.hostname === \"localhost\" || window.location.hostname === \"127.0.0.1\";\n}\n\nexport function getCurrentPort(): string {\n  return window.location.port || \"80\";\n}\n\nexport function initDevInfo(): void {\n  console.log(\"Initializing dev info...\");\n  const branch = getCurrentBranch();\n  const pr = getCurrentPR();\n  const port = getCurrentPort();\n\n  console.log(\"Dev info - Branch:\", branch, \"PR:\", pr, \"Port:\", port);\n\n  // Show banner when we have branch or PR info, but not on production ports (80/443)\n  if ((branch || pr) && port !== \"80\" && port !== \"443\") {\n    const devInfoElement = document.createElement(\"div\");\n    devInfoElement.id = \"dev-info-banner\";\n    devInfoElement.style.cssText = `\n      position: fixed;\n      top: 60px;\n      left: 0;\n      right: 0;\n      background-color: #2c2c2c;\n      color: white;\n      padding: 8px 16px;\n      font-size: 14px;\n      font-weight: bold;\n      z-index: 1000;\n      text-align: center;\n      box-shadow: 0 2px 4px rgba(0,0,0,0.2);\n    `;\n\n    let infoContent = \"\";\n    if (branch) {\n      infoContent += `<i class=\"fas fa-code-branch\"></i> Branch: <code style=\"background: black; color: white; padding: 2px 6px; border-radius: 3px;\">${branch}</code>`;\n    }\n\n    // Add PR link if available\n    if (pr) {\n      if (branch) {\n        infoContent += \" | \";\n      }\n      const prUrl = `https://github.com/idvorkin/idvorkin.github.io/pull/${pr}`;\n      infoContent += `<i class=\"fas fa-code-pull-request\"></i> PR: <a href=\"${prUrl}\" target=\"_blank\" style=\"color: #58a6ff; text-decoration: none;\"><code style=\"background: black; color: #58a6ff; padding: 2px 6px; border-radius: 3px;\">#${pr}</code></a>`;\n    }\n\n    if ((branch || pr) && port) {\n      infoContent += \" | \";\n    }\n    infoContent += `<i class=\"fas fa-server\"></i> Port: <code style=\"background: black; color: white; padding: 2px 6px; border-radius: 3px;\">${port}</code>`;\n\n    devInfoElement.innerHTML = infoContent;\n    document.body.appendChild(devInfoElement);\n\n    // Adjust body padding to account for the banner\n    const currentPaddingTop = Number.parseInt(window.getComputedStyle(document.body).paddingTop) || 0;\n    document.body.style.paddingTop = `${currentPaddingTop + 40}px`;\n  }\n}\n","/**\n * Header Copy Link Feature\n * Adds a copy link icon to headers that allows users to copy the URL with anchor\n * Handles domain remapping from idvork.in to idvorkin.azurewebsites.net\n */\n\nimport { makeRedirectUrl } from \"./shared\";\n\ninterface CopyLinkOptions {\n  iconClass?: string;\n  tooltipDuration?: number;\n  domainMapping?: {\n    from: string;\n    to: string;\n  };\n}\n\nconst DEFAULT_OPTIONS: CopyLinkOptions = {\n  iconClass: \"header-copy-link\",\n  tooltipDuration: 2000,\n  domainMapping: {\n    from: \"idvork.in/\",\n    to: \"idvorkin.azurewebsites.net/\",\n  },\n};\n\n/**\n * Creates the copy link icon element\n */\nfunction createCopyLinkIcon(options: CopyLinkOptions): HTMLElement {\n  const icon = document.createElement(\"span\");\n  icon.className = options.iconClass || DEFAULT_OPTIONS.iconClass || \"\";\n  icon.title = \"Share this section\";\n  icon.style.cursor = \"pointer\";\n  icon.style.marginLeft = \"0.5rem\";\n  icon.style.opacity = \"0\";\n  icon.style.transition = \"opacity 0.2s ease\";\n  icon.style.fontSize = \"0.8em\";\n  icon.style.userSelect = \"none\";\n\n  // Add accessibility attributes\n  icon.setAttribute(\"role\", \"button\");\n  icon.setAttribute(\"tabindex\", \"0\");\n  icon.setAttribute(\"aria-label\", \"Share this section\");\n\n  // iOS-style share icon - box with upward arrow\n  icon.innerHTML = `<svg width=\"16\" height=\"20\" viewBox=\"0 0 16 20\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"1.5\" stroke-linecap=\"round\" stroke-linejoin=\"round\" style=\"vertical-align: middle;\">\n    <!-- Upward arrow -->\n    <path d=\"M8 2 L8 12\"/>\n    <path d=\"M4 5.5 L8 2 L12 5.5\"/>\n    <!-- Box -->\n    <path d=\"M3 8 L3 17 Q3 18 4 18 L12 18 Q13 18 13 17 L13 8\"/>\n  </svg>`;\n\n  return icon;\n}\n\n/**\n * Creates the GitHub issue icon element with Font Awesome fallback\n */\nfunction createGitHubIssueIcon(): HTMLElement {\n  const icon = document.createElement(\"span\");\n  icon.className = \"header-github-issue\";\n  icon.title = \"Create GitHub issue for this section\";\n  icon.style.cursor = \"pointer\";\n  icon.style.marginLeft = \"0.5rem\";\n  icon.style.opacity = \"0\";\n  icon.style.transition = \"opacity 0.2s ease\";\n  icon.style.fontSize = \"0.8em\";\n  icon.style.userSelect = \"none\";\n\n  // Add accessibility attributes\n  icon.setAttribute(\"role\", \"button\");\n  icon.setAttribute(\"tabindex\", \"0\");\n  icon.setAttribute(\"aria-label\", \"Create GitHub issue for this section\");\n\n  // Check if Font Awesome is available (more robust detection)\n  const hasFontAwesome = !!(\n    document.querySelector('link[href*=\"font-awesome\"]') ||\n    document.querySelector('script[src*=\"font-awesome\"]') ||\n    document.querySelector(\".fa, .fab, .fas, .far\") ||\n    // Check for inline styles that might include Font Awesome\n    Array.from(document.styleSheets).some((sheet) => {\n      try {\n        return sheet.href?.includes(\"font-awesome\");\n      } catch (e) {\n        return false; // Cross-origin stylesheets may throw\n      }\n    })\n  );\n\n  if (hasFontAwesome) {\n    const faIcon = document.createElement(\"i\");\n    faIcon.className = \"fab fa-github\";\n    icon.appendChild(faIcon);\n  } else {\n    // Fallback to text or emoji\n    icon.textContent = \"‚ö†Ô∏è\";\n  }\n\n  return icon;\n}\n\n/**\n * Creates an inline popup editor for adding comments (safe from XSS)\n */\nfunction createIssuePopup(headerId: string, headerText: string): HTMLElement {\n  const popup = document.createElement(\"div\");\n  popup.className = \"github-issue-popup\";\n  popup.style.display = \"none\";\n  popup.id = `github-issue-popup-${headerId}`;\n\n  // Create structure safely without innerHTML to prevent XSS\n  const content = document.createElement(\"div\");\n  content.className = \"github-issue-popup-content\";\n\n  // Header\n  const header = document.createElement(\"div\");\n  header.className = \"github-issue-popup-header\";\n\n  const h4 = document.createElement(\"h4\");\n  h4.textContent = `Report Issue: ${headerText}`; // Safe from XSS\n\n  const closeBtn = document.createElement(\"button\");\n  closeBtn.className = \"github-issue-popup-close\";\n  closeBtn.title = \"Close\";\n  closeBtn.textContent = \"√ó\";\n\n  header.appendChild(h4);\n  header.appendChild(closeBtn);\n\n  // Body\n  const body = document.createElement(\"div\");\n  body.className = \"github-issue-popup-body\";\n\n  // Title input\n  const titleLabel = document.createElement(\"label\");\n  titleLabel.setAttribute(\"for\", `issue-title-${headerId}`);\n  titleLabel.textContent = \"Issue Title:\";\n\n  const titleInput = document.createElement(\"input\");\n  titleInput.type = \"text\";\n  titleInput.id = `issue-title-${headerId}`;\n  titleInput.className = \"github-issue-title\";\n  titleInput.placeholder = \"Brief title for the issue\";\n\n  // Description textarea\n  const descLabel = document.createElement(\"label\");\n  descLabel.setAttribute(\"for\", `issue-comment-${headerId}`);\n  descLabel.textContent = \"Description:\";\n\n  const descTextarea = document.createElement(\"textarea\");\n  descTextarea.id = `issue-comment-${headerId}`;\n  descTextarea.className = \"github-issue-comment\";\n  descTextarea.placeholder = \"Describe the issue with this section...\";\n  descTextarea.rows = 4;\n\n  // Buttons\n  const buttonsDiv = document.createElement(\"div\");\n  buttonsDiv.className = \"github-issue-popup-buttons\";\n\n  const submitBtn = document.createElement(\"button\");\n  submitBtn.className = \"github-issue-submit\";\n  submitBtn.textContent = \"Create Issue on GitHub\";\n\n  const cancelBtn = document.createElement(\"button\");\n  cancelBtn.className = \"github-issue-cancel\";\n  cancelBtn.textContent = \"Cancel\";\n\n  buttonsDiv.appendChild(submitBtn);\n  buttonsDiv.appendChild(cancelBtn);\n\n  // Hint\n  const hintDiv = document.createElement(\"div\");\n  hintDiv.className = \"github-issue-popup-hint\";\n  const small = document.createElement(\"small\");\n  small.textContent = \"Tip: Press Ctrl+Enter (Cmd+Enter on Mac) to submit\";\n  hintDiv.appendChild(small);\n\n  // Assemble body\n  body.appendChild(titleLabel);\n  body.appendChild(titleInput);\n  body.appendChild(descLabel);\n  body.appendChild(descTextarea);\n  body.appendChild(buttonsDiv);\n  body.appendChild(hintDiv);\n\n  // Assemble popup\n  content.appendChild(header);\n  content.appendChild(body);\n  popup.appendChild(content);\n\n  return popup;\n}\n\n/**\n * Shows the issue popup near the header\n */\nfunction showIssuePopup(popup: HTMLElement, header: HTMLElement): void {\n  // Hide any other open popups\n  document.querySelectorAll(\".github-issue-popup\").forEach((p) => {\n    (p as HTMLElement).style.display = \"none\";\n  });\n\n  // Position the popup near the header\n  popup.style.display = \"block\";\n  popup.style.position = \"absolute\";\n  popup.style.zIndex = \"1000\";\n\n  // Get header position\n  const rect = header.getBoundingClientRect();\n  const scrollTop = window.pageYOffset || document.documentElement.scrollTop;\n  const scrollLeft = window.pageXOffset || document.documentElement.scrollLeft;\n\n  popup.style.top = `${rect.bottom + scrollTop + 10}px`;\n  popup.style.left = `${rect.left + scrollLeft}px`;\n\n  // Focus on the title input\n  const titleInput = popup.querySelector(\".github-issue-title\") as HTMLInputElement;\n  if (titleInput) {\n    titleInput.focus();\n  }\n}\n\n/**\n * Hides the issue popup\n */\nfunction hideIssuePopup(popup: HTMLElement): void {\n  popup.style.display = \"none\";\n  // Clear the textarea\n  const textarea = popup.querySelector(\".github-issue-comment\") as HTMLTextAreaElement;\n  if (textarea) {\n    textarea.value = \"\";\n  }\n}\n\n/**\n * Shows a temporary tooltip indicating the link was copied\n */\nfunction showCopiedTooltip(element: HTMLElement, duration = 2000): void {\n  // Remove any existing tooltip first\n  if (typeof document !== \"undefined\" && document.querySelector) {\n    const existingTooltip = document.querySelector(\".copy-link-tooltip\");\n    if (existingTooltip) {\n      existingTooltip.remove();\n    }\n  }\n\n  const tooltip = document.createElement(\"span\");\n  tooltip.className = \"copy-link-tooltip\";\n  tooltip.textContent = \"Copied!\";\n  tooltip.style.position = \"absolute\";\n  tooltip.style.backgroundColor = \"#333\";\n  tooltip.style.color = \"white\";\n  tooltip.style.padding = \"4px 8px\";\n  tooltip.style.borderRadius = \"4px\";\n  tooltip.style.fontSize = \"12px\";\n  tooltip.style.zIndex = \"1000\";\n  tooltip.style.marginLeft = \"10px\";\n  tooltip.style.marginTop = \"-5px\";\n\n  element.parentElement?.appendChild(tooltip);\n\n  setTimeout(() => {\n    tooltip.remove();\n  }, duration);\n}\n\n/**\n * Builds a breadcrumb from the page name and header hierarchy\n */\nfunction buildBreadcrumbFrom(header: HTMLElement | null): string {\n  if (!header) return \"\";\n\n  // Get the page name from URL\n  const pathname = window.location.pathname;\n  const pageName = pathname.replace(/^\\//, \"\").replace(/\\.html$/, \"\") || \"index\";\n\n  // Convert page name to readable format (replace hyphens with spaces)\n  const readablePageName = pageName.replace(/-/g, \" \");\n\n  // Build header hierarchy\n  const headerHierarchy: string[] = [];\n  const tagName = header.tagName;\n  const headerLevel = Number.parseInt(tagName.substring(1)); // Get number from H1, H2, etc.\n\n  // Get the current header's text\n  const currentHeaderText = Array.from(header.childNodes)\n    .filter((node) => node.nodeType === Node.TEXT_NODE)\n    .map((node) => node.textContent?.trim())\n    .join(\" \")\n    .trim();\n\n  // For H2+, find parent headers\n  if (headerLevel >= 2) {\n    // Look for parent headers by traversing backwards through the DOM\n    let prevElement = header.previousElementSibling;\n    const foundHeaders: { level: number; text: string }[] = [];\n    const seenLevels = new Set<number>();\n\n    while (prevElement) {\n      const prevTagName = prevElement.tagName;\n      if (prevTagName?.match(/^H[1-6]$/)) {\n        const prevLevel = Number.parseInt(prevTagName.substring(1));\n\n        // Only collect headers that are higher level (lower number) than current\n        // and we haven't seen this level yet (to get the most recent parent)\n        if (prevLevel < headerLevel && !seenLevels.has(prevLevel)) {\n          const prevHeaderText = Array.from(prevElement.childNodes)\n            .filter((node) => node.nodeType === Node.TEXT_NODE)\n            .map((node) => node.textContent?.trim())\n            .join(\" \")\n            .trim();\n\n          if (prevHeaderText) {\n            foundHeaders.push({ level: prevLevel, text: prevHeaderText });\n            seenLevels.add(prevLevel);\n          }\n\n          // If we found an H1, we can stop (top level)\n          if (prevLevel === 1) break;\n        }\n      }\n      prevElement = prevElement.previousElementSibling;\n    }\n\n    // Add headers in hierarchical order (H1 > H2 > ...)\n    foundHeaders.sort((a, b) => a.level - b.level);\n    foundHeaders.forEach((h) => headerHierarchy.push(h.text));\n  }\n\n  // Add current header\n  headerHierarchy.push(currentHeaderText);\n\n  // Build the breadcrumb string with better formatting\n  let breadcrumb = `[${readablePageName}]`;\n  if (headerHierarchy.length > 0) {\n    // Limit to 3 levels max for readability\n    const limitedHierarchy = headerHierarchy.slice(0, 3);\n    breadcrumb += `: ${limitedHierarchy.join(\" > \")}`;\n\n    // Add ellipsis if there are more levels\n    if (headerHierarchy.length > 3) {\n      breadcrumb += \" ...\";\n    }\n  }\n\n  return breadcrumb;\n}\n\n/**\n * Transforms the URL according to the domain mapping rules\n */\nfunction transformUrl(url: string, options: CopyLinkOptions): string {\n  let transformedUrl = url;\n\n  // Always transform localhost to production domain\n  transformedUrl = transformedUrl.replace(\"localhost:4000/\", \"idvorkin.azurewebsites.net/\");\n\n  // Also handle the production domain mapping if configured\n  if (options.domainMapping) {\n    transformedUrl = transformedUrl.replace(options.domainMapping.from, options.domainMapping.to);\n  }\n\n  // Extract just the path and anchor\n  const urlObj = new URL(transformedUrl);\n  const pathname = urlObj.pathname.replace(/^\\//, \"\").replace(/\\.html$/, \"\") || \"index\";\n  const anchor = urlObj.hash.replace(\"#\", \"\");\n\n  // Return path#anchor format for tinyurl\n  return anchor ? `${pathname}#${anchor}` : pathname;\n}\n\n/**\n * Shares or copies the header link based on device capabilities\n */\nasync function shareOrCopyHeaderLink(headerId: string, options: CopyLinkOptions): Promise<boolean> {\n  try {\n    // Build the URL using tinyurl redirect format\n    const currentUrl = window.location.href;\n    const anchorUrl = currentUrl.includes(\"#\")\n      ? currentUrl.replace(/#.*/, `#${headerId}`)\n      : `${currentUrl}#${headerId}`;\n\n    // Transform the URL for tinyurl redirect\n    const transformedUrl = transformUrl(anchorUrl, options);\n    const tinyUrl = `https://tinyurl.com/igor-blog/?path=${encodeURIComponent(transformedUrl)}`;\n\n    // Get header text for share title (clean it to remove button text)\n    const header = document.getElementById(headerId);\n    // Get just the text content of the header, excluding child elements\n    const headerText = header\n      ? Array.from(header.childNodes)\n          .filter((node) => node.nodeType === Node.TEXT_NODE)\n          .map((node) => node.textContent?.trim())\n          .join(\" \")\n          .trim()\n      : \"\";\n    const shareTitle = `${headerText} - Igor's Blog`;\n\n    // Get preview text for the section\n    const previewText = getPreviewText(headerId);\n\n    // Build breadcrumb \"From\" line\n    const breadcrumbFrom = buildBreadcrumbFrom(header);\n\n    // Create share text with preview\n    let shareText = `From: ${breadcrumbFrom} ...`;\n    if (previewText) {\n      shareText = `From: ${breadcrumbFrom} ...\\n\\n${previewText}`;\n    }\n\n    // Check if this is a mobile device\n    const isMobile = /Mobi|Android|iPhone|iPad|iPod/i.test(navigator.userAgent);\n\n    // Use native share only on mobile devices that support it\n    if (navigator.share && isMobile) {\n      try {\n        await navigator.share({\n          title: shareTitle,\n          text: shareText,\n          url: tinyUrl,\n        });\n        console.log(`üì± Shared via native share: ${tinyUrl}`);\n        return true; // Indicates share was successful\n      } catch (shareError) {\n        // User cancelled share or share failed, fall through to clipboard\n        console.log(\"Share cancelled or failed, falling back to clipboard\", shareError);\n      }\n    }\n\n    // For clipboard copy, format with preview text\n    let clipboardText = tinyUrl;\n    if (previewText) {\n      // Format as: From: Title, Preview, URL (similar to social media shares)\n      clipboardText = `From: ${breadcrumbFrom} ...\\n\\n${previewText}\\n\\n${tinyUrl}`;\n    }\n\n    // Fallback to clipboard copy for desktop or if share fails\n    await navigator.clipboard.writeText(clipboardText);\n    console.log(`üìã Copied to clipboard with preview: ${clipboardText.substring(0, 100)}...`);\n    return false; // Indicates copy was used instead of share\n  } catch (error) {\n    console.error(\"Failed to share/copy header link:\", error);\n\n    // Fallback: use textarea method if clipboard API fails\n    try {\n      const currentUrl = window.location.href;\n      const anchorUrl = currentUrl.includes(\"#\")\n        ? currentUrl.replace(/#.*/, `#${headerId}`)\n        : `${currentUrl}#${headerId}`;\n\n      const transformedUrl = transformUrl(anchorUrl, options);\n      const tinyUrl = `https://tinyurl.com/igor-blog/?path=${encodeURIComponent(transformedUrl)}`;\n\n      // Get preview text for fallback\n      const header = document.getElementById(headerId);\n      const breadcrumbFrom = buildBreadcrumbFrom(header);\n      const previewText = getPreviewText(headerId);\n\n      let clipboardText = tinyUrl;\n      if (previewText) {\n        clipboardText = `From: ${breadcrumbFrom} ...\\n\\n${previewText}\\n\\n${tinyUrl}`;\n      }\n\n      // Use textarea fallback for copying\n      const textArea = document.createElement(\"textarea\");\n      textArea.value = clipboardText;\n      document.body.appendChild(textArea);\n      textArea.select();\n      document.execCommand(\"copy\");\n      document.body.removeChild(textArea);\n\n      console.log(`üìã Copied with preview (fallback): ${clipboardText.substring(0, 100)}...`);\n      return false;\n    } catch (fallbackError) {\n      console.error(\"Failed to copy URL even with fallback:\", fallbackError);\n      throw fallbackError;\n    }\n  }\n}\n\n/**\n * Gets or creates an ID for a header element\n */\nfunction getOrCreateHeaderId(header: HTMLElement): string {\n  if (header.id) {\n    return header.id;\n  }\n\n  // Create an ID from the header text\n  const text = header.textContent || \"\";\n  const id = text\n    .toLowerCase()\n    .replace(/[^\\w\\s-]/g, \"\") // Remove special characters\n    .replace(/\\s+/g, \"-\") // Replace spaces with hyphens\n    .replace(/-+/g, \"-\") // Replace multiple hyphens with single\n    .replace(/^-|-$/g, \"\"); // Remove leading/trailing hyphens\n\n  // Ensure uniqueness\n  let uniqueId = id;\n  let counter = 1;\n  while (document.getElementById(uniqueId)) {\n    uniqueId = `${id}-${counter}`;\n    counter++;\n  }\n\n  header.id = uniqueId;\n  return uniqueId;\n}\n\n/**\n * Gets the first non-empty paragraph of content after a header\n */\nfunction getFirstParagraphAfterHeader(header: HTMLElement): string {\n  let nextElement = header.nextElementSibling;\n\n  // Look for the first non-empty content before the next header\n  while (nextElement) {\n    // Stop if we hit another header\n    if (nextElement.tagName.match(/^H[1-6]$/)) {\n      break;\n    }\n\n    // Check if it's a paragraph with actual content\n    if (nextElement.tagName === \"P\") {\n      const text = (nextElement.textContent || \"\").trim();\n      if (text.length > 0) {\n        // Found non-empty paragraph - truncate if too long\n        return text.length > 500 ? `${text.substring(0, 497)}...` : text;\n      }\n    }\n\n    // If it's a list (UL or OL), get text from the list items\n    if (nextElement.tagName === \"UL\" || nextElement.tagName === \"OL\") {\n      const listItems = nextElement.querySelectorAll(\"li\");\n      const itemTexts: string[] = [];\n      let totalLength = 0;\n\n      for (const li of Array.from(listItems)) {\n        // Only get direct text content, not nested lists\n        const text = Array.from(li.childNodes)\n          .filter(\n            (node) =>\n              node.nodeType === Node.TEXT_NODE ||\n              (node.nodeType === Node.ELEMENT_NODE &&\n                (node as Element).tagName !== \"UL\" &&\n                (node as Element).tagName !== \"OL\"),\n          )\n          .map((node) => (node.textContent || \"\").trim())\n          .join(\" \")\n          .trim();\n\n        if (text.length > 0) {\n          itemTexts.push(`‚Ä¢ ${text}`);\n          totalLength += text.length;\n          if (totalLength > 400) break; // Stop if we have enough text\n        }\n      }\n\n      if (itemTexts.length > 0) {\n        // Join with newlines for better formatting\n        const combinedText = itemTexts.join(\"\\n\");\n        return combinedText.length > 500 ? `${combinedText.substring(0, 497)}...` : combinedText;\n      }\n    }\n\n    nextElement = nextElement.nextElementSibling;\n  }\n\n  return \"\";\n}\n\n/**\n * Truncates text to a maximum length, preserving word boundaries\n */\nfunction truncateText(text: string, maxLength = 400): string {\n  if (text.length <= maxLength) {\n    return text;\n  }\n\n  // Truncate to maxLength and find the last space\n  const truncated = text.substring(0, maxLength);\n  const lastSpace = truncated.lastIndexOf(\" \");\n\n  if (lastSpace > 0) {\n    return `${truncated.substring(0, lastSpace)}...`;\n  }\n\n  return `${truncated}...`;\n}\n\n/**\n * Extracts preview text from the page content, with anchor-aware logic\n */\nfunction getPreviewText(headerId?: string): string {\n  // If we have a specific header ID (anchor), try to get text after it\n  if (headerId) {\n    const header = document.getElementById(headerId);\n    if (header) {\n      // Try to get text from the first paragraph after the header\n      const paragraphText = getFirstParagraphAfterHeader(header);\n      if (paragraphText) {\n        return truncateText(paragraphText);\n      }\n\n      // Try to get text from any content elements after the header\n      let nextElement = header.nextElementSibling;\n      const textParts: string[] = [];\n      let charCount = 0;\n\n      while (nextElement && charCount < 400) {\n        // Stop if we hit another header\n        if (nextElement.tagName.match(/^H[1-6]$/)) {\n          break;\n        }\n\n        // Get text from various content elements\n        if (\n          nextElement.tagName === \"P\" ||\n          nextElement.tagName === \"LI\" ||\n          nextElement.tagName === \"BLOCKQUOTE\" ||\n          nextElement.tagName === \"DIV\"\n        ) {\n          const text = (nextElement.textContent || \"\").trim();\n          if (text.length > 0) {\n            textParts.push(text);\n            charCount += text.length;\n          }\n        }\n\n        nextElement = nextElement.nextElementSibling;\n      }\n\n      if (textParts.length > 0) {\n        return truncateText(textParts.join(\" \"));\n      }\n    }\n  }\n\n  // Fallback: try to find preview text from various content areas\n  const contentSelectors = [\n    \"article\",\n    \"main\",\n    \".content\",\n    \".post-content\",\n    \".entry-content\",\n    \"#content-holder\",\n    \".content-holder\",\n  ];\n\n  for (const selector of contentSelectors) {\n    const contentArea = document.querySelector(selector);\n    if (contentArea) {\n      // Find the first paragraph in the content area\n      const firstParagraph = contentArea.querySelector(\"p\");\n      if (firstParagraph) {\n        const text = (firstParagraph.textContent || \"\").trim();\n        if (text.length > 0) {\n          return truncateText(text);\n        }\n      }\n    }\n  }\n\n  // Last resort: find the first paragraph on the page\n  const firstParagraph = document.querySelector(\"p\");\n  if (firstParagraph) {\n    const text = (firstParagraph.textContent || \"\").trim();\n    if (text.length > 0) {\n      return truncateText(text);\n    }\n  }\n\n  // If no preview text found, return empty string\n  return \"\";\n}\n\n/**\n * Creates a GitHub issue URL for a section with optional custom title and description\n */\nfunction createGitHubIssueUrl(\n  headerId: string,\n  headerText: string,\n  customTitle?: string,\n  customDescription?: string,\n  header?: HTMLElement,\n): string {\n  // Get the current page path from the URL\n  const pathname = window.location.pathname;\n  // Remove leading slash and .html extension if present\n  const pagePath = pathname.replace(/^\\//, \"\").replace(/\\.html$/, \"\");\n\n  // Get the actual source file path from the meta tag (set by Jekyll)\n  const metaTag = document.querySelector('meta[property=\"markdown-path\"]');\n  const sourceFile = metaTag ? metaTag.getAttribute(\"content\") : `${pagePath || \"index\"}.md`;\n\n  // Construct the GitHub issue URL\n  const repoUrl = \"https://github.com/idvorkin/idvorkin.github.io\";\n\n  // Format title as: page/section: custom title\n  const formattedTitle = customTitle\n    ? `${pagePath || \"index\"}/${headerId}: ${customTitle}`\n    : `${pagePath || \"index\"}/${headerId}: Issue with ${headerText}`;\n\n  const issueTitle = encodeURIComponent(formattedTitle);\n\n  // Use description if provided, otherwise use title as description\n  const description = customDescription || customTitle || `Issue with section: ${headerText}`;\n\n  // Get first paragraph of content if header is provided\n  const firstParagraph = header ? getFirstParagraphAfterHeader(header) : \"\";\n\n  // Format location as a single line with hyperlinks\n  const locationLine = `üìç [${pagePath || \"index\"}](https://idvorkin.azurewebsites.net/${pagePath})/[${headerId}](https://idvorkin.azurewebsites.net/${pagePath}/${headerId}) - [[GitHub]](${repoUrl}/blob/main/${sourceFile}#${headerId})`;\n\n  // Format the issue body with location at top, then description, then content excerpt\n  let issueBodyContent = `${locationLine}\\n\\n## Description\\n\\n${description}\\n\\n`;\n\n  // Add content excerpt with section heading if available\n  if (firstParagraph) {\n    issueBodyContent += `## Content Excerpt\\n\\n#### ${headerText}\\n\\n> ${firstParagraph}\\n\\n`;\n  }\n\n  const issueBody = encodeURIComponent(issueBodyContent);\n\n  return `${repoUrl}/issues/new?title=${issueTitle}&body=${issueBody}`;\n}\n\n// Store cleanup functions for each header\nconst headerCleanupFunctions = new WeakMap<HTMLElement, (() => void)[]>();\n\n// Store popup references for lazy loading\nconst headerPopups = new WeakMap<HTMLElement, HTMLElement>();\n\n// Track all headers for cleanup purposes\nconst trackedHeaders = new Set<HTMLElement>();\n\n/**\n * Creates and shows popup lazily when needed\n */\nfunction getOrCreatePopup(header: HTMLElement, headerId: string): HTMLElement {\n  let popup = headerPopups.get(header);\n\n  if (!popup) {\n    popup = createIssuePopup(headerId, header.textContent || \"\");\n    document.body.appendChild(popup);\n    headerPopups.set(header, popup);\n\n    // Setup popup event handlers\n    setupPopupEventHandlers(popup, header, headerId);\n  }\n\n  return popup;\n}\n\n/**\n * Sets up event handlers for a popup\n */\nfunction setupPopupEventHandlers(popup: HTMLElement, header: HTMLElement, headerId: string): void {\n  const cleanupFunctions: (() => void)[] = [];\n\n  // Handle close button\n  const closeBtn = popup.querySelector(\".github-issue-popup-close\");\n  if (closeBtn) {\n    const closeHandler = () => hideIssuePopup(popup);\n    closeBtn.addEventListener(\"click\", closeHandler);\n    cleanupFunctions.push(() => closeBtn.removeEventListener(\"click\", closeHandler));\n  }\n\n  // Handle cancel button\n  const cancelBtn = popup.querySelector(\".github-issue-cancel\");\n  if (cancelBtn) {\n    const cancelHandler = () => hideIssuePopup(popup);\n    cancelBtn.addEventListener(\"click\", cancelHandler);\n    cleanupFunctions.push(() => cancelBtn.removeEventListener(\"click\", cancelHandler));\n  }\n\n  // Function to submit the issue\n  const submitIssue = () => {\n    const titleInput = popup.querySelector(\".github-issue-title\") as HTMLInputElement;\n    const commentTextarea = popup.querySelector(\".github-issue-comment\") as HTMLTextAreaElement;\n\n    const customTitle = titleInput?.value || \"\";\n    const customDescription = commentTextarea?.value || \"\";\n\n    const issueUrl = createGitHubIssueUrl(headerId, header.textContent || \"\", customTitle, customDescription, header);\n    window.open(issueUrl, \"_blank\");\n\n    hideIssuePopup(popup);\n  };\n\n  // Handle submit button\n  const submitBtn = popup.querySelector(\".github-issue-submit\");\n  if (submitBtn) {\n    submitBtn.addEventListener(\"click\", submitIssue);\n    cleanupFunctions.push(() => submitBtn.removeEventListener(\"click\", submitIssue));\n  }\n\n  // Handle keyboard shortcuts (Ctrl/Cmd + Enter)\n  const titleInput = popup.querySelector(\".github-issue-title\") as HTMLInputElement;\n  const commentTextarea = popup.querySelector(\".github-issue-comment\") as HTMLTextAreaElement;\n\n  const handleKeydown = (event: KeyboardEvent) => {\n    if ((event.ctrlKey || event.metaKey) && event.key === \"Enter\") {\n      event.preventDefault();\n      submitIssue();\n    }\n  };\n\n  if (titleInput) {\n    titleInput.addEventListener(\"keydown\", handleKeydown);\n    cleanupFunctions.push(() => titleInput.removeEventListener(\"keydown\", handleKeydown));\n  }\n  if (commentTextarea) {\n    commentTextarea.addEventListener(\"keydown\", handleKeydown);\n    cleanupFunctions.push(() => commentTextarea.removeEventListener(\"keydown\", handleKeydown));\n  }\n\n  // Store cleanup functions for this popup\n  const existingCleanup = headerCleanupFunctions.get(header) || [];\n  headerCleanupFunctions.set(header, [...existingCleanup, ...cleanupFunctions]);\n}\n\n/**\n * Adds copy link functionality to a single header\n */\nfunction addCopyLinkToHeader(header: HTMLElement, options: CopyLinkOptions): void {\n  // Check if this header already has a copy link\n  const existingCopyLink = header.querySelector(`.${options.iconClass || DEFAULT_OPTIONS.iconClass}`);\n  if (existingCopyLink) {\n    return; // Skip if copy link already exists\n  }\n\n  const headerId = getOrCreateHeaderId(header);\n  const copyIcon = createCopyLinkIcon(options);\n  const githubIcon = createGitHubIssueIcon();\n  const cleanupFunctions: (() => void)[] = [];\n\n  // Add click handler for share/copy link\n  const shareClickHandler = async (event: Event) => {\n    event.preventDefault();\n    event.stopPropagation();\n\n    const wasShared = await shareOrCopyHeaderLink(headerId, options);\n    // Only show tooltip if we copied (not if we used native share)\n    if (!wasShared) {\n      showCopiedTooltip(copyIcon, options.tooltipDuration);\n    }\n  };\n  copyIcon.addEventListener(\"click\", shareClickHandler);\n  cleanupFunctions.push(() => copyIcon.removeEventListener(\"click\", shareClickHandler));\n\n  // Add keyboard support for accessibility\n  const keyboardHandler = (event: KeyboardEvent) => {\n    if (event.key === \"Enter\" || event.key === \" \") {\n      event.preventDefault();\n      shareClickHandler(event);\n    }\n  };\n  copyIcon.addEventListener(\"keydown\", keyboardHandler);\n  cleanupFunctions.push(() => copyIcon.removeEventListener(\"keydown\", keyboardHandler));\n\n  // Add click handler for GitHub issue icon to show popup (lazy loading)\n  const githubClickHandler = (event: Event) => {\n    event.preventDefault();\n    event.stopPropagation();\n\n    const popup = getOrCreatePopup(header, headerId);\n    showIssuePopup(popup, header);\n  };\n  githubIcon.addEventListener(\"click\", githubClickHandler);\n  cleanupFunctions.push(() => githubIcon.removeEventListener(\"click\", githubClickHandler));\n\n  // Close popup when clicking outside (use capture phase to avoid conflicts)\n  const handleOutsideClick = (event: MouseEvent) => {\n    const popup = headerPopups.get(header);\n    if (\n      popup &&\n      !popup.contains(event.target as Node) &&\n      event.target !== githubIcon &&\n      !githubIcon.contains(event.target as Node) &&\n      popup.style.display !== \"none\"\n    ) {\n      hideIssuePopup(popup);\n    }\n  };\n\n  // Add slight delay to avoid immediate closing\n  const timeoutId = setTimeout(() => {\n    document.addEventListener(\"click\", handleOutsideClick, true);\n    cleanupFunctions.push(() => document.removeEventListener(\"click\", handleOutsideClick, true));\n  }, 100);\n  cleanupFunctions.push(() => clearTimeout(timeoutId));\n\n  // Append the icons to the header\n  header.appendChild(copyIcon);\n  header.appendChild(githubIcon);\n\n  // Add hover effects to the header\n  const mouseEnterHandler = () => {\n    copyIcon.style.opacity = \"1\";\n    githubIcon.style.opacity = \"1\";\n  };\n  const mouseLeaveHandler = () => {\n    copyIcon.style.opacity = \"0\";\n    githubIcon.style.opacity = \"0\";\n  };\n\n  header.addEventListener(\"mouseenter\", mouseEnterHandler);\n  header.addEventListener(\"mouseleave\", mouseLeaveHandler);\n  cleanupFunctions.push(() => {\n    header.removeEventListener(\"mouseenter\", mouseEnterHandler);\n    header.removeEventListener(\"mouseleave\", mouseLeaveHandler);\n  });\n\n  // Store cleanup functions for this header\n  headerCleanupFunctions.set(header, cleanupFunctions);\n  trackedHeaders.add(header);\n}\n\n/**\n * Cleans up all event listeners and popups\n */\nexport function cleanupHeaderCopyLinks(): void {\n  // Clean up all stored event listeners\n  trackedHeaders.forEach((header) => {\n    const cleanupFns = headerCleanupFunctions.get(header);\n    if (cleanupFns) {\n      cleanupFns.forEach((fn) => fn());\n    }\n\n    // Remove popup if exists\n    const popup = headerPopups.get(header);\n    if (popup) {\n      popup.remove();\n    }\n  });\n\n  // Clear the tracked headers set\n  trackedHeaders.clear();\n\n  // Reset initialization flag\n  isHeaderCopyLinksInitialized = false;\n}\n\n/**\n * Initializes the copy link feature for all headers in the content\n */\nexport function initHeaderCopyLinks(customOptions: Partial<CopyLinkOptions> = {}): void {\n  const options: CopyLinkOptions = { ...DEFAULT_OPTIONS, ...customOptions };\n\n  // Find all headers on the page (including H1)\n  // Some H1s are outside content-holder, so search the entire document\n  const allHeaders = document.querySelectorAll(\"h1, h2, h3, h4, h5, h6\");\n\n  for (const header of Array.from(allHeaders)) {\n    addCopyLinkToHeader(header as HTMLElement, options);\n  }\n}\n\n/**\n * Adds CSS styles for the copy link feature\n */\nexport function addHeaderCopyLinkStyles(): void {\n  const styleId = \"header-copy-link-styles\";\n\n  // Check if styles already exist\n  if (document.getElementById(styleId)) {\n    return;\n  }\n\n  const style = document.createElement(\"style\");\n  style.id = styleId;\n  style.textContent = `\n    .header-copy-link,\n    .header-github-issue {\n      opacity: 0;\n      margin-left: 0.5rem;\n      transition: opacity 0.2s ease;\n      cursor: pointer;\n      user-select: none;\n      font-size: 0.8em;\n      color: #6c757d;\n      text-decoration: none;\n    }\n    \n    .header-copy-link:hover {\n      color: #007bff;\n    }\n    \n    .header-github-issue:hover {\n      color: #dc3545;\n    }\n    \n    h1:hover .header-copy-link,\n    h2:hover .header-copy-link,\n    h3:hover .header-copy-link,\n    h4:hover .header-copy-link,\n    h5:hover .header-copy-link,\n    h6:hover .header-copy-link,\n    h1:hover .header-github-issue,\n    h2:hover .header-github-issue,\n    h3:hover .header-github-issue,\n    h4:hover .header-github-issue,\n    h5:hover .header-github-issue,\n    h6:hover .header-github-issue {\n      opacity: 1;\n    }\n    \n    /* Ensure headers have relative positioning for tooltip placement */\n    h1, h2, h3, h4, h5, h6 {\n      position: relative;\n    }\n    \n    /* GitHub Issue Popup Styles */\n    .github-issue-popup {\n      position: absolute;\n      background: white;\n      border: 1px solid #ddd;\n      border-radius: 8px;\n      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);\n      width: 400px;\n      max-width: 90vw;\n      z-index: 1000;\n    }\n    \n    .github-issue-popup-content {\n      padding: 0;\n    }\n    \n    .github-issue-popup-header {\n      display: flex;\n      justify-content: space-between;\n      align-items: center;\n      padding: 12px 16px;\n      background: #f6f8fa;\n      border-bottom: 1px solid #e1e4e8;\n      border-radius: 8px 8px 0 0;\n    }\n    \n    .github-issue-popup-header h4 {\n      margin: 0;\n      font-size: 14px;\n      color: #24292e;\n      white-space: nowrap;\n      overflow: hidden;\n      text-overflow: ellipsis;\n      max-width: 350px;\n    }\n    \n    .github-issue-popup-close {\n      background: none;\n      border: none;\n      font-size: 24px;\n      color: #586069;\n      cursor: pointer;\n      padding: 0;\n      width: 24px;\n      height: 24px;\n      display: flex;\n      align-items: center;\n      justify-content: center;\n    }\n    \n    .github-issue-popup-close:hover {\n      color: #24292e;\n    }\n    \n    .github-issue-popup-body {\n      padding: 16px;\n    }\n    \n    .github-issue-popup-body label {\n      display: block;\n      margin-bottom: 4px;\n      font-size: 13px;\n      font-weight: 600;\n      color: #24292e;\n    }\n    \n    .github-issue-title,\n    .github-issue-comment {\n      width: 100%;\n      padding: 8px 12px;\n      margin-bottom: 12px;\n      border: 1px solid #e1e4e8;\n      border-radius: 6px;\n      font-size: 14px;\n      font-family: -apple-system, BlinkMacSystemFont, \"Segoe UI\", Helvetica, Arial, sans-serif;\n      box-sizing: border-box;\n    }\n    \n    .github-issue-title:focus,\n    .github-issue-comment:focus {\n      outline: none;\n      border-color: #0366d6;\n      box-shadow: 0 0 0 3px rgba(3, 102, 214, 0.1);\n    }\n    \n    .github-issue-comment {\n      resize: vertical;\n      min-height: 80px;\n    }\n    \n    .github-issue-popup-buttons {\n      display: flex;\n      gap: 8px;\n      justify-content: flex-end;\n      margin-top: 12px;\n    }\n    \n    .github-issue-submit,\n    .github-issue-cancel {\n      padding: 6px 16px;\n      border-radius: 6px;\n      font-size: 14px;\n      font-weight: 500;\n      cursor: pointer;\n      border: 1px solid;\n      transition: all 0.2s;\n    }\n    \n    .github-issue-submit {\n      background: #2ea44f;\n      color: white;\n      border-color: #2ea44f;\n    }\n    \n    .github-issue-submit:hover {\n      background: #2c974b;\n      border-color: #2c974b;\n    }\n    \n    .github-issue-cancel {\n      background: #fafbfc;\n      color: #24292e;\n      border-color: #e1e4e8;\n    }\n    \n    .github-issue-cancel:hover {\n      background: #f3f4f6;\n      border-color: #c9ced1;\n    }\n    \n    .github-issue-popup-hint {\n      margin-top: 8px;\n      text-align: center;\n      color: #586069;\n    }\n  `;\n\n  document.head.appendChild(style);\n}\n\n// Global flag to prevent multiple initializations\nlet isHeaderCopyLinksInitialized = false;\n\n/**\n * Reset the initialization flag (for testing purposes)\n */\nexport function resetHeaderCopyLinksInitialization(): void {\n  isHeaderCopyLinksInitialized = false;\n}\n\n/**\n * Main initialization function - call this to enable the feature\n */\nexport function enableHeaderCopyLinks(options: Partial<CopyLinkOptions> = {}): void {\n  // Prevent multiple initializations\n  if (isHeaderCopyLinksInitialized) {\n    return;\n  }\n\n  isHeaderCopyLinksInitialized = true;\n\n  // Add styles\n  addHeaderCopyLinkStyles();\n\n  // Initialize the feature\n  if (document.readyState === \"loading\") {\n    document.addEventListener(\"DOMContentLoaded\", () => {\n      initHeaderCopyLinks(options);\n    });\n  } else {\n    initHeaderCopyLinks(options);\n  }\n}\n","/**\n * Image Zoom functionality for blog posts\n * Automatically wraps images in blog posts with GLightbox functionality\n */\n\n// Constants for retry logic\nconst MAX_RETRY_ATTEMPTS = 50;\nconst RETRY_DELAY_MS = 100;\nconst MAX_RETRY_TIME_MS = MAX_RETRY_ATTEMPTS * RETRY_DELAY_MS;\n\ndeclare global {\n  interface Window {\n    GLightbox: any;\n  }\n}\n\nexport function enableImageZoom(retryCount = 0) {\n  // Skip if running in test environment without DOM\n  if (typeof document === \"undefined\") {\n    return;\n  }\n\n  console.log(\"üñºÔ∏è Enabling image zoom functionality\");\n\n  // Wait for GLightbox to be available with retry limit\n  if (typeof window.GLightbox === \"undefined\") {\n    if (retryCount < MAX_RETRY_ATTEMPTS) {\n      // Max 5 seconds of retries (50 * 100ms)\n      console.warn(\n        `‚ö†Ô∏è GLightbox not found, retrying in ${RETRY_DELAY_MS}ms (attempt ${retryCount + 1}/${MAX_RETRY_ATTEMPTS})`,\n      );\n      setTimeout(() => enableImageZoom(retryCount + 1), RETRY_DELAY_MS);\n      return;\n    }\n    console.error(\n      `‚ùå GLightbox failed to load after ${MAX_RETRY_TIME_MS / 1000} seconds, aborting image zoom initialization`,\n    );\n    return;\n  }\n\n  // Find all images in the main content area (excluding headers, sidebars, etc.)\n  const contentSelectors = [\n    \"p img\", // Images inside paragraphs (most common in markdown)\n    \"li img\", // Images inside list items\n    \".container img\",\n    \".post-content img\",\n    \"article img\",\n    \".markdown-body img\",\n    \"main img\",\n  ];\n\n  const images = document.querySelectorAll(contentSelectors.join(\", \"));\n  console.log(`üîç Found ${images.length} images to process`);\n\n  let processedCount = 0;\n\n  images.forEach((img, index) => {\n    const imageElement = img as HTMLImageElement;\n\n    // Skip if already wrapped in a link\n    if (imageElement.parentElement?.tagName === \"A\") {\n      console.log(`‚è≠Ô∏è Skipping image ${index + 1} - already wrapped`);\n      return;\n    }\n\n    // Skip tiny images (likely icons)\n    if (imageElement.naturalWidth > 0 && imageElement.naturalWidth < 100 && imageElement.naturalHeight < 100) {\n      console.log(\n        `‚è≠Ô∏è Skipping image ${index + 1} - too small (${imageElement.naturalWidth}x${imageElement.naturalHeight})`,\n      );\n      return;\n    }\n\n    // Create wrapper link\n    const link = document.createElement(\"a\");\n    link.href = imageElement.src;\n    link.className = \"glightbox\";\n    link.setAttribute(\"data-gallery\", \"post-images\");\n\n    // Add description from alt text if available\n    if (imageElement.alt) {\n      link.setAttribute(\"data-description\", imageElement.alt);\n    }\n\n    // Wrap the image\n    imageElement.parentNode?.insertBefore(link, imageElement);\n    link.appendChild(imageElement);\n\n    processedCount++;\n    console.log(\n      `‚úÖ Processed image ${index + 1}: ${imageElement.src.substring(imageElement.src.lastIndexOf(\"/\") + 1)}`,\n    );\n  });\n\n  // Initialize GLightbox for all .glightbox elements (including any existing ones)\n  try {\n    const lightbox = window.GLightbox({\n      selector: \".glightbox\",\n      touchNavigation: true,\n      loop: true,\n      autoplayVideos: true,\n    });\n\n    if (processedCount > 0) {\n      console.log(`üéâ Image zoom enabled for ${processedCount} images`);\n    } else {\n      console.log(\"‚ÑπÔ∏è No images needed processing, but GLightbox initialized for existing elements\");\n    }\n  } catch (error) {\n    console.error(\"Error initializing GLightbox:\", error);\n  }\n}\n\n// Auto-initialize when DOM is ready\nif (typeof document !== \"undefined\") {\n  if (document.readyState === \"loading\") {\n    document.addEventListener(\"DOMContentLoaded\", () => enableImageZoom());\n  } else {\n    // DOM already loaded, but wait a bit for dynamic content\n    setTimeout(() => enableImageZoom(), 500);\n  }\n}\n","// Import shared functions\n\nimport { initRecentAllPosts } from \"./recent\";\nimport { initRecentPosts } from \"./recent-posts\";\nimport {\n  type IURLInfo,\n  type IURLInfoMap,\n  MakeBackLinkHTML,\n  append_randomizer_div,\n  get_link_info,\n  random_from_list,\n  shuffle,\n} from \"./shared\";\n// Import graph but we'll only initialize it from the graph.html page\nimport \"./graph\";\nimport { initDevInfo } from \"./dev-info\";\nimport { enableHeaderCopyLinks } from \"./header-copy-link\";\nimport { enableImageZoom } from \"./image-zoom\";\n\n// Type declarations for external libraries\ndeclare global {\n  interface Window {\n    Mousetrap(): MousetrapStatic;\n  }\n}\n\ninterface MousetrapStatic {\n  bind(key: string, callback: (e: Event) => void): void;\n}\n\nlet tocExpand = true;\n\nfunction checkExpandToggle() {\n  const toc = $(\".ui-toc-dropdown .toc\");\n  const toggle = $(\".expand-toggle\");\n\n  if (toc.length === 0 || toggle.length === 0) {\n    console.warn(\"TOC or toggle elements not found for expand/collapse\");\n    return;\n  }\n\n  if (!tocExpand) {\n    toc.removeClass(\"expand\");\n    toggle.text(\"Expand all\");\n  } else {\n    toc.addClass(\"expand\");\n    toggle.text(\"Collapse all\");\n  }\n}\n\nconst PROD_ORIGIN = \"https://idvork.in\";\nconst DEV_ORIGIN_KEY = \"idvorkin_dev_origin\";\n\nfunction isProduction(): boolean {\n  return window.location.hostname === \"idvork.in\";\n}\n\n/** Returns true if origin looks like a dev server (hostname or non-standard port). */\nfunction isDevOrigin(origin: string): boolean {\n  try {\n    const url = new URL(origin);\n    const host = url.hostname;\n    // Hostname patterns that are always dev\n    if (host === \"localhost\" || host === \"127.0.0.1\" || host.endsWith(\".ts.net\")) {\n      return true;\n    }\n    // Non-standard port is a strong dev signal\n    return url.port !== \"\" && url.port !== \"80\" && url.port !== \"443\";\n  } catch {\n    return false;\n  }\n}\n\n/**\n * On page load: detect if we arrived from a dev server via document.referrer.\n * Cross-origin referrer policy (strict-origin-when-cross-origin) only sends\n * the origin, not the full path, so we can only check isDevOrigin on it.\n * The isDevOrigin guard prevents external sites from poisoning the value.\n */\nfunction saveDevOriginFromReferrer() {\n  if (!document.referrer) return;\n  try {\n    const referrerOrigin = new URL(document.referrer).origin;\n    if (isDevOrigin(referrerOrigin)) {\n      localStorage.setItem(DEV_ORIGIN_KEY, referrerOrigin);\n    }\n  } catch {\n    // Invalid referrer URL, ignore\n  }\n}\n\nfunction SwapProdAndTest() {\n  const path = `${window.location.pathname}${window.location.search}${window.location.hash}`;\n  if (isProduction()) {\n    // Prod ‚Üí Dev: use stored dev origin, fallback to localhost:4000\n    const devOrigin = localStorage.getItem(DEV_ORIGIN_KEY) || \"http://localhost:4000\";\n    window.location.href = `${devOrigin}${path}`;\n  } else {\n    // Dev ‚Üí Prod: save origin locally, navigate with clean URL\n    localStorage.setItem(DEV_ORIGIN_KEY, window.location.origin);\n    window.location.href = `${PROD_ORIGIN}${path}`;\n  }\n}\n\nfunction ForceShowRightSideBar() {\n  const toc = $(\"#right-sidebar\");\n  const mainContent = $(\"#main-content\");\n\n  if (toc.length > 0) {\n    toc.removeClass();\n    toc.addClass(\"col-4 pl-0\");\n  }\n\n  if (mainContent.length > 0) {\n    mainContent.removeClass();\n    mainContent.addClass(\"col-8 pr-0\");\n  }\n\n  // Hide DropUp\n  const tocDropUp = $(\"#id-ui-toc-dropdown\");\n  if (tocDropUp.length > 0) {\n    tocDropUp.removeClass();\n    tocDropUp.addClass(\"d-none\");\n  }\n}\n\n// <!-- Copied from hackmd-extras.js -->\nfunction generateToc(id, showPinToc) {\n  const target = $(`#${id}`);\n  if (target.length === 0) {\n    console.warn(`Target element #${id} not found for TOC generation`);\n    return;\n  }\n\n  target.html(\"\");\n\n  // Check if content-holder exists\n  if ($(\"#content-holder\").length === 0) {\n    console.warn(\"Content holder not found for TOC generation\");\n    return;\n  }\n\n  /* eslint-disable no-unused-vars */\n  /* @ts-ignore:TS2339*/\n  const toc = new window.Toc(\"content-holder\", {\n    level: 3,\n    top: -1,\n    class: \"toc\",\n    ulClass: \"nav\",\n    targetId: id,\n  });\n  /* eslint-enable no-unused-vars */\n  if (target.text() === \"undefined\") {\n    target.html(\"\");\n  }\n  const tocMenu = $('<div class=\"toc-menu\"></div');\n  const toggle = $('<a class=\"expand-toggle\" href=\"#\">Collapse all</a>');\n  const backToTop = $('<a class=\"back-to-top\" href=\"#\">Top of page</a>');\n  const gotoBottom = $('<a class=\"go-to-bottom\" href=\"#\">Bottom of page</a>');\n  const forceSideBar = $('<a class=\"go-to-bottom\" href=\"#\">Pin ToC</a>');\n  checkExpandToggle();\n  toggle.click((e) => {\n    e.preventDefault();\n    e.stopPropagation();\n    tocExpand = !tocExpand;\n    checkExpandToggle();\n  });\n  backToTop.click((e) => {\n    e.preventDefault();\n    e.stopPropagation();\n    window.scrollTo(0, 0);\n  });\n  gotoBottom.click((e) => {\n    e.preventDefault();\n    e.stopPropagation();\n    window.scrollTo(0, document.body.scrollHeight);\n  });\n  forceSideBar.click((e) => ForceShowRightSideBar());\n  tocMenu.append(toggle).append(backToTop).append(gotoBottom);\n  if (showPinToc) {\n    tocMenu.append(forceSideBar);\n  }\n  target.append(tocMenu);\n}\n\n// MakeBackLinkHTML moved to shared.ts\n\nasync function AddLinksToPage(allUrls: IURLInfoMap) {\n  // TODO handle redirects\n  let page_path: string;\n  let backlinks: string[] | undefined;\n  let frontlinks: string[] | undefined;\n\n  try {\n    if (!allUrls) {\n      console.log(\"No backlinks available\");\n      return;\n    }\n\n    page_path = new URL(document.URL).pathname;\n\n    // Safe check for the URL in allUrls\n    if (!allUrls[page_path]) {\n      console.log(`Page ${page_path} not found in backlinks`);\n      return;\n    }\n\n    backlinks = allUrls[page_path]?.incoming_links;\n    frontlinks = allUrls[page_path]?.outgoing_links;\n\n    if (!backlinks && !frontlinks) {\n      console.log(`No backlinks for the page ${page_path}`);\n      return;\n    }\n  } catch (error) {\n    console.log(`Error processing links: ${error instanceof Error ? error.message : String(error)}`);\n    return;\n  }\n\n  const link_parent_location = $(\"#links-to-page\");\n  if (!link_parent_location || link_parent_location.length === 0) {\n    console.log(\"No back_link_location\");\n    return;\n  }\n\n  link_parent_location.append(\n    `\n<ul class=\"nav nav-tabs nav-fill\" id=\"myTab\" role=\"tablist\">\n  <li class=\"nav-item\" role=\"presentation\">\n    <button class=\"nav-link active\" id=\"home-tab\" data-bs-toggle=\"tab\" data-bs-target=\"#incoming\" type=\"button\" role=\"tab\" aria-controls=\"incoming\" aria-selected=\"true\">Links to here</button>\n  </li>\n  <li class=\"nav-item\" role=\"presentation\">\n    <button class=\"nav-link\" id=\"profile-tab\" data-bs-toggle=\"tab\" data-bs-target=\"#outgoing\" type=\"button\" role=\"tab\" aria-controls=\"outgoing\" aria-selected=\"false\">Link from here</button>\n  </li>\n  <li class=\"nav-item\" role=\"presentation\">\n    <button class=\"nav-link\" id=\"profile-tab\" data-bs-toggle=\"tab\" data-bs-target=\"#graph\" type=\"button\" role=\"tab\" aria-controls=\"outgoing\" aria-selected=\"false\">Graph</button>\n  </li>\n</ul>\n<div class=\"tab-content\" id=\"myTabContent\">\n  <div class=\"tab-pane fade show active \" id=\"incoming\" role=\"tabpanel\" aria-labelledby=\"incoming-tab\"></div>\n  <div class=\"tab-pane fade\" id=\"outgoing\" role=\"tabpanel\" aria-labelledby=\"outgoing-tab\"></div>\n  <div class=\"tab-pane fade\" id=\"graph\" role=\"tabpanel\" aria-labelledby=\"outgoing-tab\">\n    <span> View the graph for: </span>\n  </div>\n</div>\n`,\n  );\n\n  const incoming_location = link_parent_location.find(\"#incoming\");\n  const sort_descending_by_size = (a, b) => Number(allUrls[b].doc_size) - Number(allUrls[a].doc_size);\n\n  if (backlinks) {\n    for (const backlink of backlinks.sort(sort_descending_by_size)) {\n      const url_info = allUrls[backlink];\n      incoming_location.append(MakeBackLinkHTML(url_info));\n    }\n  }\n\n  // remove front links not in\n  const clean_front_links = [];\n  for (const frontlink of frontlinks) {\n    if (allUrls[frontlink]) {\n      clean_front_links.push(frontlink);\n    }\n  }\n\n  const outgoing_location = link_parent_location.find(\"#outgoing\");\n  if (clean_front_links) {\n    for (const link of clean_front_links.sort(sort_descending_by_size)) {\n      const url_info = allUrls[link];\n      outgoing_location.append(MakeBackLinkHTML(url_info));\n    }\n  }\n  const graph_location = link_parent_location.find(\"#graph\");\n  const stripped_page_path = page_path.replace(/\\//g, \"\");\n  graph_location.append(`<a href='/graph#${stripped_page_path}'>${page_path} (${stripped_page_path}) </a>`);\n}\nfunction make_html_summary_link(link, url_info: IURLInfo) {\n  if (!url_info) {\n    return make_html_summary_link_error(link, \"URL info is undefined\");\n  }\n\n  const url = url_info.url || \"#\";\n  const title = url_info.title || \"Untitled\";\n  const description = url_info.description || \"No description available\";\n\n  const attribution = `(From:<a href='${url}'> ${title}</a>)`;\n\n  return `<div>\n        <i> ${description}</i> ${attribution}\n    </div>`;\n}\n\nfunction make_html_summary_link_error(link, error) {\n  const href = link?.attr ? link.attr(\"href\") : \"unknown\";\n  return `<span class='text-danger'>Error: Invalid link for ${href} ${error} </span>`;\n}\n\nfunction AddSummarysToPage(backLinks: IBacklinks) {\n  if (!backLinks) {\n    console.log(\"No backlinks data available\");\n    return;\n  }\n\n  try {\n    const summary_links = $.makeArray($(\".summary-link\"));\n\n    if (!summary_links || summary_links.length === 0) {\n      console.log(\"No summary links found\");\n      return;\n    }\n\n    for (const raw_link of summary_links) {\n      const link = $(raw_link);\n      try {\n        if (!link || !link.attr) {\n          console.log(\"Invalid link element\");\n          return;\n        }\n\n        let ref = link.attr(\"href\");\n        if (!ref) {\n          link.html(make_html_summary_link_error(link, \"missing href\"));\n          return;\n        }\n\n        // Check if backLinks has necessary properties\n        if (!backLinks.redirects || !backLinks.url_info) {\n          link.html(make_html_summary_link_error(link, \"incomplete backLinks data\"));\n          return;\n        }\n\n        // Resolve redirect\n        if (backLinks.redirects[ref] !== undefined) {\n          ref = backLinks.redirects[ref];\n        }\n\n        // Look up in url info\n        if (backLinks.url_info[ref] === undefined) {\n          link.html(make_html_summary_link_error(link, \"not found in url info\"));\n          return;\n        }\n\n        link.html(make_html_summary_link(link, backLinks.url_info[ref]));\n      } catch (e) {\n        if (link?.html) {\n          link.html(make_html_summary_link_error(link, e));\n        } else {\n          console.error(\"Error processing link and unable to display error:\", e);\n        }\n      }\n    }\n  } catch (error) {\n    console.error(\"Error processing summary links:\", error);\n  }\n}\n\nasync function add_link_loader() {\n  // Prevent multiple initialization using global flag\n  const globalFlag = \"__idvorkin_add_link_loader_initialized__\";\n  if ((window as any)[globalFlag]) {\n    return;\n  }\n  (window as any)[globalFlag] = true;\n\n  AddLinksToPage(await get_link_info());\n  AddSummarysToPage(await get_back_links());\n}\n\nexport interface IBacklinks {\n  redirects: { [key: string]: string };\n  url_info: IURLInfoMap;\n}\n\nlet cached_back_links: IBacklinks = null;\nasync function get_back_links(): Promise<IBacklinks> {\n  try {\n    if (cached_back_links != null) {\n      return cached_back_links;\n    }\n\n    const url = window.location.href;\n    const prodPrefix = \"https://idvork.in\";\n    const isProd = url.includes(prodPrefix);\n\n    let backlinks_url = \"\";\n    if (isProd) {\n      backlinks_url =\n        \"https://raw.githubusercontent.com/idvorkin/idvorkin.github.io/master/back-links.json?flush_cache=True\";\n    } else {\n      backlinks_url = \"/back-links.json\";\n    }\n\n    // Use a try/catch here in case $.getJSON fails\n    try {\n      const backlinksJson = (await $.getJSON(backlinks_url)) as IBacklinks;\n\n      // Ensure we have the required properties\n      if (!backlinksJson.redirects) backlinksJson.redirects = {};\n      if (!backlinksJson.url_info) backlinksJson.url_info = {};\n\n      cached_back_links = backlinksJson;\n      return cached_back_links;\n    } catch (error) {\n      console.error(\"Error fetching backlinks JSON:\", error);\n      return { redirects: {}, url_info: {} };\n    }\n  } catch (error) {\n    console.error(\"Error in get_back_links:\", error);\n    return { redirects: {}, url_info: {} };\n  }\n}\n\nfunction search() {\n  // Redirect to main page for search\n  window.location.href = \"/\";\n}\n\nfunction keyboard_shortcut_loader() {\n  const mouseTrap = window.Mousetrap();\n  mouseTrap.bind(\"s\", (e) => search());\n  mouseTrap.bind(\"t\", (e) => ForceShowRightSideBar());\n  mouseTrap.bind(\"p\", (e) => SwapProdAndTest());\n  mouseTrap.bind(\"a\", (e) => {\n    location.href = \"/all\";\n  });\n  mouseTrap.bind(\"m\", (e) => {\n    location.href = \"/toc\";\n  });\n  mouseTrap.bind(\"6\", (e) => {\n    location.href = \"/ig66\";\n  });\n\n  const shortcutHelp = `\nTry these shortcuts:\n  s - search\n  / - start chatting with others\n  t - force sidebar\n  p - swap prod and test\n  z - surprise me\n  a - all posts\n  m - global toc\n  6 - family journal\n  `;\n  mouseTrap.bind(\"?\", (e) => alert(shortcutHelp));\n}\n\n/**\n * Replaces placeholder links in the document with their corresponding list content.\n * @param listReplacements - An object mapping placeholder texts to list elements.\n */\nfunction replacePlaceholdersWithLists(listReplacements: Record<string, Element>) {\n  for (const [placeholderText, list] of Object.entries(listReplacements)) {\n    // Use native DOM methods if jQuery is not available\n    const placeholderLink =\n      typeof $ !== \"undefined\" && $.fn\n        ? $(`a[href=${placeholderText}]`).first()[0]\n        : document.querySelector(`a[href=\"${placeholderText}\"]`);\n\n    if (!placeholderLink) return; // Placeholder not found, skip\n\n    const listClone = list.cloneNode(true) as Element;\n    if (listClone.children.length > 0) {\n      listClone.children[0].remove(); // Remove the 'lookup id' from the list\n    }\n    placeholderLink.replaceWith(listClone);\n\n    // remove the list from the document\n    list.remove();\n  }\n}\n\n/**\n * Builds a map of list replacements by scanning the document for specially formatted lists.\n * @returns An object where keys are placeholder texts and values are the corresponding list elements.\n */\nfunction buildListReplacementMap(): Record<string, Element> {\n  const replacements: Record<string, Element> = {};\n\n  // Use native DOM methods if jQuery is not available\n  const lists = typeof $ !== \"undefined\" && $.fn ? $(\"ul\").toArray() : Array.from(document.querySelectorAll(\"ul\"));\n\n  for (const list of lists) {\n    const firstListItem = list.firstElementChild;\n    if (!firstListItem) continue;\n\n    const firstItemText = firstListItem.textContent;\n    if (!firstItemText || !firstItemText.startsWith(\"l\")) continue;\n\n    const listId = Number.parseInt(firstItemText.substring(1));\n    if (Number.isNaN(listId)) continue;\n\n    replacements[firstItemText] = list;\n  }\n  return replacements;\n}\n\n/**\n * Replaces list placeholders in tables with actual list content.\n * This function orchestrates the process of finding and replacing placeholders.\n */\nfunction replaceListPlaceholdersInTables() {\n  const listReplacements = buildListReplacementMap();\n  replacePlaceholdersWithLists(listReplacements);\n}\n\nfunction load_globals() {\n  // Prevent multiple initialization using global flag\n  const globalFlag = \"__idvorkin_load_globals_initialized__\";\n  if ((window as any)[globalFlag]) {\n    return;\n  }\n  (window as any)[globalFlag] = true;\n\n  // If we arrived from a dev server, remember its origin for the \"p\" key\n  saveDevOriginFromReferrer();\n\n  $(add_link_loader);\n  $(keyboard_shortcut_loader);\n\n  // Replace list placeholders in tables\n  if (typeof $ !== \"undefined\" && $.fn && $.fn.ready) {\n    $(document).ready(replaceListPlaceholdersInTables);\n  } else if (typeof document !== \"undefined\") {\n    if (document.readyState === \"loading\") {\n      document.addEventListener(\"DOMContentLoaded\", replaceListPlaceholdersInTables);\n    } else {\n      replaceListPlaceholdersInTables();\n    }\n  }\n\n  initRecentPosts();\n\n  // Initialize recent posts if the container exists\n  if (document.getElementById(\"last-modified-posts\")) {\n    initRecentAllPosts();\n  }\n\n  $(() => {\n    generateToc(\"ui-toc\", true);\n    generateToc(\"ui-toc-affix\", false);\n  });\n\n  // Initialize header copy links\n  enableHeaderCopyLinks();\n\n  // Initialize image zoom functionality\n  enableImageZoom();\n\n  // Initialize dev info display\n  initDevInfo();\n}\n\nexport {\n  load_globals,\n  get_link_info,\n  shuffle,\n  random_from_list,\n  append_randomizer_div,\n  enableHeaderCopyLinks,\n  initDevInfo,\n};\n\n// Auto-initialize when the script loads\nif (typeof $ !== \"undefined\" && $.fn && $.fn.ready) {\n  $(document).ready(load_globals);\n} else if (typeof document !== \"undefined\") {\n  if (document.readyState === \"loading\") {\n    document.addEventListener(\"DOMContentLoaded\", load_globals);\n  } else {\n    load_globals();\n  }\n}\n","import { append_randomizer_div, random_from_list } from \"./index\";\n\ninterface BlogPost {\n  url: string;\n  title: string;\n  thumbnail: string;\n  published: string;\n  excerpt: string;\n  tags: string[];\n}\n\nfunction html_for_blogpost(post: BlogPost) {\n  const item = $(\"<div/>\");\n  // TODO: HACK: Strip to the right of Week number\n  const title_href = `<h4> <a href='${post.url}'}>${post.title}</a></h4>`;\n  const monthNames = [\n    \"January\",\n    \"February\",\n    \"March\",\n    \"April\",\n    \"May\",\n    \"June\",\n    \"July\",\n    \"August\",\n    \"September\",\n    \"October\",\n    \"November\",\n    \"December\",\n  ];\n\n  item.append(title_href);\n  // HACK: Upsize to larger thumbnail, seems like blogger auto resizes to include a 320 image as well.\n  const thumbnail_url = post.thumbnail.replace(\"s72-c\", \"s320\");\n\n  const published_date = new Date(post.published);\n  const excerptDisplayText = `\n    <div> ${monthNames[published_date.getMonth()]} ${published_date.getFullYear()} - ${post.excerpt}\n    </div>\n   `;\n  if (post.thumbnail !== \"\") {\n    console.log(post.title);\n    console.log(published_date);\n    item.append(\n      // `<div> <a href='${post.url}'}><img src='${thumbnail_url}'/></div>`\n      `\n      <div style='overflow:auto'>\n\n      <a href='${post.url}'}><img class=\"img-fluid\" style='float:left; margin-right:10px' src='${thumbnail_url}'/></a>\n      ${excerptDisplayText}\n      </div>`,\n    );\n  } else {\n    item.append(excerptDisplayText);\n  }\n  const ret = item.html();\n  return ret;\n}\n\nfunction get_achievement_posts(imported_posts: BlogPost[]) {\n  return imported_posts.filter((post) => post.title.toLowerCase().includes(\"achievement\"));\n}\nfunction get_recent_posts(imported_posts: BlogPost[]) {\n  return imported_posts.filter((post) => post.tags.includes(\"family-journal\"));\n}\n\nfunction ProcessImports(posts: BlogPost[]) {\n  console.log(\"Processing\", posts.length, \"posts\");\n  if (!posts) {\n    console.log(\"No posts being imported\");\n    return;\n  }\n\n  //\n  // Import all history\n  const random_div = \"#random-post\";\n  const achievement_div = \"#achievment\";\n  const random_recent = \"#random-recent\";\n\n  append_randomizer_div(random_div, () => html_for_blogpost(random_from_list(posts)));\n\n  // Add a random achievement post\n  append_randomizer_div(achievement_div, () => html_for_blogpost(random_from_list(get_achievement_posts(posts))));\n  append_randomizer_div(random_recent, () => html_for_blogpost(random_from_list(get_recent_posts(posts))));\n}\n\nfunction add_imported_blog_posts() {\n  const imported_posts_url = \"/ig66/ig66-export.json\";\n  $.getJSON(imported_posts_url, ProcessImports);\n}\n//\n// Todo put in own file\ninterface Role {\n  title: string;\n  summary: string;\n  full_text: string;\n}\n\ninterface Roles {\n  roles: Role[];\n}\n\nfunction html_for_role(role: Role) {\n  // url encode the role title\n  const role_file_name = role.title.replace(/ /g, \"%20\");\n  const voices = [\"igor\", \"ammon\"];\n  const random_voice = voices[Math.floor(Math.random() * voices.length)];\n  // Yucky - toggle_play_pause is a global function in enjoy2.md - bleh,  so brittle\n  return `\n  <div>\n    <audio id=\"eulogy-player\">\n      <source src=\"https://github.com/idvorkin/blob/raw/master/read_eulogy/${random_voice}/${role_file_name}.mp3\" type=\"audio/mp3\">\n    </audio>\n  <b>${role.title} <a class='lead' onclick=\"toggle_play_pause('eulogy-player')\">üîà</a></b> - ${role.summary}\n  </div>\n  `;\n}\n\nfunction ProcessEulogy(div: string, roles: Roles) {\n  if (!roles) {\n    console.log(\"No roles being imported\");\n    return;\n  }\n  console.log(\"Processing\", roles.roles.length, \"roles\");\n\n  // Import all history\n  append_randomizer_div(div, () => html_for_role(random_from_list(roles.roles)));\n}\n\nfunction add_eulogy_roles(div: string) {\n  const imported_posts_url = \"/eulogy.json\";\n  $.getJSON(imported_posts_url, (roles: Roles) => ProcessEulogy(div, roles));\n}\n\nexport { add_imported_blog_posts, add_eulogy_roles, html_for_role };\n","import { append_randomizer_div, random_from_list, shuffle } from \"./index\";\n\n// Declare global Plotly\ndeclare const Plotly: any;\n\n/**\n * Represents a node in a tree structure used for visualization\n */\nexport class TreeNode {\n  name: string;\n  children: TreeNode[];\n  value: number;\n\n  constructor({\n    name,\n    value = 25,\n    children = [],\n  }: {\n    name;\n    value?;\n    children?;\n  }) {\n    this.name = name;\n    // Keep it interesting\n    this.children = shuffle(children) as TreeNode[];\n    this.value = value;\n  }\n}\n\n/**\n * Main function to add random prompts to categories on the page\n * @param categoryToPromptsProvider Function that provides category-to-prompts mapping (default: internal implementation)\n * @param renderer Function that renders prompts for a category (default: internal implementation)\n */\nexport function add_random_prompts(\n  categoryToPromptsProvider = category_to_prompts,\n  renderer = render_prompt_for_category,\n) {\n  const map_category_to_prompts = categoryToPromptsProvider();\n  for (const category of map_category_to_prompts.keys()) {\n    renderer(category, map_category_to_prompts.get(category));\n  }\n}\n\n/**\n * Renders prompts for a specific category\n * @param category The category element\n * @param prompts_for_category Array of prompts for this category\n * @param jQueryProvider jQuery function (default: global $)\n * @param randomizerAppender Function to append randomizer div (default: append_randomizer_div)\n */\nexport function render_prompt_for_category(\n  category,\n  prompts_for_category,\n  jQueryProvider = $,\n  randomizerAppender = append_randomizer_div,\n) {\n  //print one of the prompts\n  const get_random_prompt_html = () =>\n    `<span>${random_from_list(\n      prompts_for_category,\n    )}</span><span style=\"float: right; cursor: pointer;\" title=\"Click for another prompt\">üîÑ</span>`;\n\n  // add a place holder for random div.\n  const new_element = jQueryProvider(`<div class=\"alert alert-primary\" role=\"alert\"/>`);\n  jQueryProvider(category).after(new_element);\n  randomizerAppender(new_element, get_random_prompt_html);\n}\n\n/**\n * Extracts prompts from categories on the page\n * @param jQueryProvider jQuery function (default: global $)\n * @returns Map of category elements to their prompts\n */\nexport function category_to_prompts(jQueryProvider = $) {\n  // prompt_categories are H3s with a UL under them, and the li's under there are the prompt.\n  const starting_node = jQueryProvider(\"h3\").first();\n  let current_category = starting_node;\n  let prompts_for_category = [];\n  const map_category_to_prompts = new Map();\n\n  for (let node = starting_node; node.length !== 0; node = jQueryProvider(node).next()) {\n    if (node.prop(\"tagName\") === \"H3\") {\n      // Build prompt map\n      map_category_to_prompts.set(current_category, prompts_for_category);\n\n      // start processing next categroy\n      current_category = node;\n      prompts_for_category = [];\n      continue;\n    }\n\n    // in a category, prompts are the children of the first unordered list, so skip\n    // stuff that isn't a list\n    if (node.prop(\"tagName\") !== \"UL\") {\n      continue;\n    }\n    // we should now be the first list in the category\n    prompts_for_category = Array.from(jQueryProvider(node).find(\"li\")).map((li) => jQueryProvider(li).text());\n  }\n\n  map_category_to_prompts.set(current_category, prompts_for_category);\n\n  return map_category_to_prompts;\n}\n\n/**\n * Performs a breadth-first traversal of a tree\n * @param node The root node of the tree to traverse\n * @yields [current node, parent node] pairs for each node in the tree\n */\nexport function* breadth_first_walk(node: TreeNode) {\n  if (!node) {\n    return;\n  }\n  const Q = [];\n  Q.push([node, null as TreeNode]);\n  while (Q.length > 0) {\n    const [current, parent]: [TreeNode, TreeNode] = Q.shift();\n    for (const child of current.children ?? []) {\n      Q.push([child, current]);\n    }\n    yield [current, parent];\n  }\n}\n\n/**\n * Converts a tree structure to Plotly's data format for visualization\n * @param root Root node of the tree\n * @returns Object with ids, labels, and parents arrays for Plotly\n */\nexport function tree_to_plotly_data_format(root) {\n  // Plotly needs a tree to be flattened into a set of lists\n  // ids\n  // labels\n  // parents\n  // values\n\n  const names_parent_names = Array.from(breadth_first_walk(root)).map(([n, p]) => [n.name, p?.name]);\n\n  return {\n    ids: names_parent_names.map(([n, p]) => n),\n    labels: names_parent_names.map(([n, p]) => n),\n    parents: names_parent_names.map(([n, p]) => p),\n  };\n}\n\n/**\n * Converts category elements to category text with their associated prompts\n * @param mapProvider Function that provides category-to-prompts mapping (default: internal implementation)\n * @returns Map of category texts to their prompts\n */\nexport function category_to_prompts_text(mapProvider = category_to_prompts) {\n  const map = mapProvider();\n  const list = Array.from(map.entries()).map(([k, v], _index) => [(k as any).text(), v]);\n  return new Map(list as any);\n}\n\n/**\n * Gets a random prompt for a specific label from the tree\n * @param label The label to find in the tree\n * @param tree_node The root node of the tree\n * @param map_node_to_prompts Map of node names to prompts\n * @returns Random prompt for the specified label\n */\nexport function random_prompt_for_label(label, tree_node, map_node_to_prompts) {\n  // Find the label in the tree\n  // recall bread first search returns a parent as well.\n  const result = Array.from(breadth_first_walk(tree_node)).find(([current, _parent]) => current.name === label);\n\n  if (!result) {\n    return \"Click in any box or circle\";\n  }\n\n  const [clicked_node, _parent] = result;\n\n  // Gather all the prompts for the children of the clicked node.\n  const all_prompts = Array.from(breadth_first_walk(clicked_node))\n    .map(([node, _parent]) => node) // returns node and parent\n    .filter((node) => {\n      // Check both with and without the link emoji\n      const hasWithoutEmoji = map_node_to_prompts.has(node.name);\n      const hasWithEmoji = map_node_to_prompts.has(`${node.name}üîó`);\n      return hasWithoutEmoji || hasWithEmoji;\n    })\n    .flatMap((node) => {\n      // Try to get prompts with and without emoji\n      const prompts = map_node_to_prompts.get(node.name) || map_node_to_prompts.get(`${node.name}üîó`) || [];\n      return prompts.map((prompt) => `${node.name}: ${prompt}`);\n    });\n\n  if (all_prompts.length === 0) {\n    return \"Click in any box or circle\";\n  }\n\n  return random_from_list(all_prompts);\n}\n\n/**\n * Adds a sunburst visualization to the page\n * @param plot_element_id ID of the element where the plot should be rendered\n * @param random_text_div_id ID of the div where random text should be displayed\n * @param root Root node of the tree to visualize\n * @param jQueryProvider jQuery function (default: global $)\n * @param plotlyProvider Plotly library (default: global Plotly)\n */\nexport async function add_sunburst(\n  plot_element_id,\n  random_text_div_id,\n  root: TreeNode,\n  jQueryProvider = $,\n  plotlyProvider = Plotly,\n) {\n  if (!plotlyProvider) {\n    console.error(\"Plotly is not available\");\n    return;\n  }\n\n  const sunburst_tree_flat = tree_to_plotly_data_format(root);\n  const sunburst_data = {\n    type: \"sunburst\",\n    outsidetextfont: { size: 20, color: \"#377eb8\" },\n    // leaf: {opacity: 0.4},\n    hoverinfo: \"none\",\n    marker: { line: { width: 2 } },\n    maxdepth: 2,\n    displayModeBar: false,\n  };\n  Object.assign(sunburst_data, sunburst_tree_flat);\n  (sunburst_data as any).values = undefined; // remove values to avoid sizing pie slices\n\n  const sunburst_layout = {\n    margin: { l: 0, r: 0, b: 0, t: 0 },\n    sunburstcolorway: [\"#636efa\", \"#ef553b\", \"#00cc96\"],\n  };\n  const config = {\n    displayModeBar: false,\n  };\n\n  try {\n    await plotlyProvider.newPlot(plot_element_id, [sunburst_data] as any, sunburst_layout, config);\n\n    const set_random_prompt_text = (text) => {\n      jQueryProvider(`#${random_text_div_id}`).text(text);\n    };\n\n    // Set click handler for div\n    jQueryProvider(`#${random_text_div_id}`)\n      .first()\n      .click(() => {\n        const label = jQueryProvider(\"#sunburst text:first\").text(); // Hack should use an API to find center text\n        const prompt = random_prompt_for_label(label, root, category_to_prompts_text());\n        set_random_prompt_text(prompt);\n      });\n\n    // Attach the sunburst click event handler\n    const plotElement = document.getElementById(plot_element_id);\n    if (plotElement && typeof (plotElement as any).on === \"function\") {\n      (plotElement as any).on(\"plotly_click\", (eventData: any) => {\n        if (eventData?.points?.[0]) {\n          const label = eventData.points[0].label;\n          const prompt = random_prompt_for_label(label, root, category_to_prompts_text());\n          set_random_prompt_text(prompt);\n        }\n      });\n    }\n\n    return plotElement;\n  } catch (error) {\n    console.error(\"Failed to create sunburst plot:\", error);\n    return null;\n  }\n}\n\n/**\n * Extracts a tree structure from H2, H3, and LI elements on the page\n * @param rootName The name for the root node of the tree\n * @param containerSelector Optional jQuery selector to scope the search (e.g., \"article\", \"#content\")\n * @param jQueryProvider jQuery function (default: global $)\n * @returns TreeNode representing the extracted hierarchy\n */\nexport function extract_tree_from_dom(\n  rootName = \"Root\",\n  containerSelector: string | null = null,\n  jQueryProvider: any = $,\n): TreeNode {\n  const h2Elements = containerSelector ? jQueryProvider(containerSelector).find(\"h2\") : jQueryProvider(\"h2\");\n  const rootChildren: TreeNode[] = [];\n\n  h2Elements.each((_index, h2Element) => {\n    const h2 = jQueryProvider(h2Element);\n    const h2Text = h2.text().trim();\n\n    // Skip if empty\n    if (!h2Text) return;\n\n    const h2Children: TreeNode[] = [];\n    let currentElement = h2.next();\n\n    // Process elements until we hit another H2 or run out of elements\n    while (currentElement.length > 0 && currentElement.prop(\"tagName\") !== \"H2\") {\n      if (currentElement.prop(\"tagName\") === \"H3\") {\n        const h3Text = currentElement.text().trim();\n        if (h3Text) {\n          // Add H3 as a node regardless of whether it has a UL after it\n          h2Children.push(new TreeNode({ name: h3Text }));\n        }\n      }\n      currentElement = currentElement.next();\n    }\n\n    if (h2Children.length > 0) {\n      rootChildren.push(new TreeNode({ name: h2Text, children: h2Children }));\n    }\n  });\n\n  return new TreeNode({ name: rootName, children: rootChildren });\n}\n\n/**\n * Creates a sunburst visualization automatically from the page's H2/H3 structure\n * @param plot_element_id ID of the element where the plot should be rendered\n * @param random_text_div_id ID of the div where random text should be displayed\n * @param rootName Optional name for the root node (default: \"Root\")\n * @param containerSelector Optional jQuery selector to scope the search (e.g., \"article\", \"#content\")\n * @param jQueryProvider jQuery function (default: global $)\n * @param plotlyProvider Plotly library (default: global Plotly)\n */\nexport async function add_sunburst_from_dom(\n  plot_element_id: string,\n  random_text_div_id: string,\n  rootName = \"Root\",\n  containerSelector: string | null = null,\n  jQueryProvider = $,\n  plotlyProvider = Plotly,\n) {\n  const tree = extract_tree_from_dom(rootName, containerSelector, jQueryProvider);\n  return add_sunburst(plot_element_id, random_text_div_id, tree, jQueryProvider, plotlyProvider);\n}\n\n// Export testing utilities separately\nexport const UT = {\n  breadth_first_walk,\n  shuffle,\n};\n","import { add_eulogy_roles, add_imported_blog_posts } from \"./blogger_import.js\";\nimport { append_randomizer_div, get_link_info, random_from_list } from \"./index\";\n// Only include this in the html files, one per file\n// This allows code to seet things to refactor\nimport { TreeNode, add_random_prompts, add_sunburst, add_sunburst_from_dom } from \"./random-prompter\";\n\n/**\n * Class representing the Seven Habits tree structure\n */\nexport class SevenHabits {\n  /**\n   * Gets the tree structure for Seven Habits visualization\n   * @returns {TreeNode} The root node of the Seven Habits tree\n   */\n  get_tree() {\n    const root = new TreeNode({\n      name: \"7H \",\n      children: [\n        new TreeNode({ name: \"\" }),\n        new TreeNode({ name: \"Be Proactive\" }),\n        new TreeNode({ name: \"Begin with the end in mind\" }),\n        new TreeNode({ name: \"First things First\" }),\n        new TreeNode({ name: \"Think Win/Win\" }),\n        new TreeNode({ name: \"First Understand\" }),\n        new TreeNode({ name: \"Synergize\" }),\n        new TreeNode({ name: \"Sharpen the Saw\" }),\n      ],\n    });\n    return root;\n  }\n}\n\n/**\n * Class representing the Things I Enjoy tree structure\n */\nexport class ThingsIEnjoy {\n  /**\n   * Gets the tree structure for Things I Enjoy visualization\n   * @returns {TreeNode} The root node of the Things I Enjoy tree\n   */\n  get_tree() {\n    const health = new TreeNode({\n      name: \"Health\",\n      children: [{ name: \"Physical\" }, { name: \"Emotional\" }, { name: \"Cognative\" }],\n      value: 31,\n    });\n    const magic = new TreeNode({\n      name: \"Magic\",\n      children: [\n        new TreeNode({ name: \"Card Magic\" }),\n        new TreeNode({ name: \"Coin Magic\" }),\n        new TreeNode({ name: \"Band Magic\" }),\n      ],\n    });\n    const hobbies = new TreeNode({\n      name: \"Hobbies\",\n      children: [new TreeNode({ name: \"Biking\" }), new TreeNode({ name: \"Tech\" }), new TreeNode({ name: \"Juggling\" })],\n    });\n    const relationships = new TreeNode({\n      name: \"Relationships\",\n      children: [\n        new TreeNode({ name: \"Zach\" }),\n        new TreeNode({ name: \"Amelia\" }),\n        new TreeNode({ name: \"Tori\" }),\n        new TreeNode({ name: \"Friends\" }),\n      ],\n    });\n    const joy = new TreeNode({\n      name: \"Joy\",\n      children: [new TreeNode({ name: \"Balloons\" }), new TreeNode({ name: \"Joy to Others\" })],\n    });\n\n    return new TreeNode({\n      name: \"Invest in\",\n      children: [health, magic, hobbies, relationships, joy],\n    });\n  }\n}\n\n/**\n * Creates HTML for a post preview with audio player\n * @param {Object} param0 Object containing url, title, and description\n * @returns {string} HTML string for the post preview\n */\nexport function makePostPreviewHTML({ url, title, description }) {\n  // TODO: HACK: Strip to the right of Week number\n  const title_href = `<a href='${url}'}>${title}</a>`;\n  // random id for audio player\n  const id = `audio_player_${Math.floor(Math.random() * 10000000000)}`;\n  // filename is URL with '/' turned to '_'\n  const filename = url.replace(/\\//g, \"_\");\n\n  return `\n    <div>\n        <audio id='${id}'>\n          <source src=\"https://github.com/idvorkin/blob/raw/master/url_info_voices/igor/${filename}.mp3\" type=\"audio/mp3\">\n        </audio>\n      ${title_href}:  <b><a class='lead' onclick=\"toggle_play_pause('${id}')\">üîà</a></b> ${description}\n    </div>\n  `;\n}\n\n/**\n * Generates HTML for a random post\n * @param {Function} linkInfoProvider Function to get link info (default: get_link_info)\n * @param {Function} randomSelector Function to get a random item (default: random_from_list)\n * @returns {Promise<string>} HTML string for the random post\n */\nexport async function make_random_post_html(linkInfoProvider = get_link_info, randomSelector = random_from_list) {\n  try {\n    const all_url_info = await linkInfoProvider();\n    //  Yuk, find a clearere way to do this\n    const all_pages = Object.entries(all_url_info) // returns a list of [url, info]\n      .map((e) => e[1]);\n    const random_post = randomSelector(all_pages);\n    return makePostPreviewHTML({\n      url: random_post.url,\n      title: random_post.title,\n      description: random_post.description,\n    });\n  } catch (error) {\n    console.error(\"Error generating random post HTML:\", error);\n    return \"<div>Could not load random post</div>\";\n  }\n}\n\n/**\n * Loads random eulogy roles into specified elements\n * @param {string} element1 ID of first element (default: \"#e1\")\n * @param {string} element2 ID of second element (default: \"#e2\")\n * @param {string} element3 ID of third element (default: \"#e3\")\n * @param {Function} eulogyLoader Function to add eulogy roles (default: add_eulogy_roles)\n */\nexport function load_random_eulogy(\n  element1 = \"#e1\",\n  element2 = \"#e2\",\n  element3 = \"#e3\",\n  eulogyLoader = add_eulogy_roles,\n) {\n  try {\n    eulogyLoader(element1);\n    eulogyLoader(element2);\n    eulogyLoader(element3);\n  } catch (error) {\n    console.error(\"Error loading random eulogy:\", error);\n  }\n}\n\n/**\n * Loads content for the Enjoy page\n * @param {Function} sunburstAdder Function to add sunburst (default: add_sunburst)\n * @param {Function} promptsAdder Function to add random prompts (default: add_random_prompts)\n * @param {Function} postsAdder Function to add blog posts (default: add_imported_blog_posts)\n * @param {Function} eulogyAdder Function to add eulogy roles (default: add_eulogy_roles)\n * @param {Function} randomizerAppender Function to append randomizer (default: append_randomizer_div)\n */\nexport function load_enjoy2(\n  sunburstAdder = add_sunburst,\n  promptsAdder = add_random_prompts,\n  postsAdder = add_imported_blog_posts,\n  eulogyAdder = add_eulogy_roles,\n  randomizerAppender = append_randomizer_div,\n) {\n  try {\n    sunburstAdder(\"sunburst\", \"sunburst_text\", new ThingsIEnjoy().get_tree());\n    promptsAdder();\n    postsAdder(); // has a random achievement post\n    eulogyAdder(\"#random-eulogy-role\");\n    randomizerAppender(\"#random-blog-posts\", async () => await make_random_post_html());\n  } catch (error) {\n    console.error(\"‚ùå Error loading enjoy page:\", error);\n  }\n}\n\n/**\n * Loads content for the 7 Habits page\n * @param {Function} sunburstAdder Function to add sunburst (default: add_sunburst)\n * @param {Function} promptsAdder Function to add random prompts (default: add_random_prompts)\n */\nexport function load_7_habits(sunburstAdder = add_sunburst, promptsAdder = add_random_prompts) {\n  try {\n    sunburstAdder(\"sunburst\", \"sunburst_text\", new SevenHabits().get_tree());\n    promptsAdder();\n  } catch (error) {\n    console.error(\"Error loading 7 habits page:\", error);\n  }\n}\n\n/**\n * Loads content for the IG66 page\n * @param {Function} postsAdder Function to add blog posts (default: add_imported_blog_posts)\n */\nexport function load_ig66(postsAdder = add_imported_blog_posts) {\n  try {\n    postsAdder();\n  } catch (error) {\n    console.error(\"Error loading IG66 page:\", error);\n  }\n}\n\n/**\n * Loads content for the Balance page\n * @param {Function} restChartMaker Function to make rest chart (default: make_balance_chart_by_desired_time_rest)\n * @param {Function} workChartMaker Function to make work chart (default: make_balance_chart_by_work)\n * @param {Function} radarMapMaker Function to make radar map (default: make_radar_map)\n */\nexport function load_balance(\n  restChartMaker = make_balance_chart_by_desired_time_rest,\n  workChartMaker = make_balance_chart_by_work,\n  radarMapMaker = make_radar_map,\n) {\n  try {\n    restChartMaker(\"balance-heatmap-rest\");\n    workChartMaker(\"balance-heatmap-work\");\n    radarMapMaker(\"balance-radar-map-ideal\");\n  } catch (error) {\n    console.error(\"Error loading balance page:\", error);\n  }\n}\n\n// Month names for charts\nexport const months = [\"Jan\", \"Feb\", \"Mar\", \"Apr\", \"May\", \"June\", \"July\", \"Aug\", \"Sep\", \"Oct\", \"Nov\", \"Dec\"];\n\n// Constants for heatmap configuration\nexport const row_height = 20;\nexport const heatmap_base = 100;\nexport const ideal_color = \"#00BF00\";\n\n/**\n * Creates a radar map visualization\n * @param {string} div ID of the element to render the map in\n * @param {Object} plotly Plotly library (optional)\n */\nexport async function make_radar_map(div, plotly?) {\n  const data = [\n    {\n      type: \"scatterpolar\",\n      r: [8, 8, 8, 5, 8, 8, 8],\n      theta: [\"Work\", \"Tech\", \"Health\", \"Hobbies\", \"Relationships\", \"Magic\", \"Work\"],\n      name: \"2020 Goal\",\n      fill: \"toself\",\n    },\n    {\n      type: \"scatterpolar\",\n      r: [7, 7, 5, 5, 5, 9, 7],\n      theta: [\"Work\", \"Tech\", \"Health\", \"Hobbies\", \"Relationships\", \"Magic\", \"Work\"],\n      name: \"2020 Actual\",\n      fill: \"toself\",\n    },\n  ];\n\n  const layout = {\n    polar: {\n      radialaxis: {\n        visible: true,\n        range: [0, 10],\n      },\n    },\n    showlegend: true,\n  };\n  const config = {\n    displayModeBar: false,\n  };\n\n  if (typeof plotly !== \"undefined\" && plotly) {\n    try {\n      await plotly.newPlot(div, data, layout, config);\n    } catch (error) {\n      console.error(\"Error creating radar map:\", error);\n    }\n  } else {\n    console.warn(\"Plotly is not defined, skipping chart rendering\");\n  }\n}\n\n/**\n * Creates a heatmap for work balance\n * @param {string} div ID of the element to render the heatmap in\n * @param {Object} plotly Plotly library (optional)\n */\nexport async function make_balance_chart_by_work(div, plotly?) {\n  const roles = [\"Tech\", \"Work\"];\n  const layout = {\n    height: row_height * roles.length + heatmap_base,\n    margin: {\n      t: 5,\n    },\n    pad: 0,\n  };\n  const color_scale = [\n    [0.0, \"darkblue\"],\n    [0.4, \"blue\"],\n    [0.5, ideal_color],\n    [0.6, \"darkred\"],\n    [1.0, \"red\"],\n  ];\n  const gap_desire_over_time = [\n    [7, 4, 7, 8, 2, 4, 2, 3, 2, 8], //  Tech\n    [10, 7, 5, 5, 3, 5, 6, 6, 7, 5], //  Work\n  ];\n\n  const data = [\n    {\n      colorscale: color_scale,\n      zmin: 0,\n      zmax: 10,\n      x: months.slice(2, 13),\n      y: roles,\n      z: gap_desire_over_time,\n      type: \"heatmap\",\n    },\n  ];\n  const config = {\n    displayModeBar: false,\n  };\n\n  if (typeof plotly !== \"undefined\" && plotly) {\n    try {\n      await plotly.newPlot(div, data, layout, config);\n    } catch (error) {\n      console.error(\"Error creating work balance chart:\", error);\n    }\n  } else {\n    console.warn(\"Plotly is not defined, skipping chart rendering\");\n  }\n}\n\n/**\n * Creates a heatmap for desired rest time\n * @param {string} div ID of the element to render the heatmap in\n * @param {Object} plotly Plotly library (optional)\n */\nexport async function make_balance_chart_by_desired_time_rest(div, plotly?) {\n  const roles = [\"Health\", \"Hobbies\", \"Family\", \"Magic\"];\n  const gap_desire_over_time = [\n    // J, F, M, A, M, J, J, A, S, O, N, D\n    [4, 4, 3, 4, 5, 3, 2, 2, 3, 2], // Health\n    [4, 4, 3, 4, 5, 4, 4, 2, 4, 5], // Hobbies\n    [2, 3, 3, 4, 1, 5, 4, 3, 2, 4], // Family\n    [5, 5, 5, 4, 5, 5, 4, 5, 4, 5], //  Magic\n  ];\n\n  const color_scale = [\n    [0.0, \"red\"],\n    [0.4, \"darkred\"],\n    [0.5, ideal_color],\n    [0.6, \"blue\"],\n    [1.0, \"darkblue\"],\n  ];\n  const data = [\n    {\n      colorscale: color_scale,\n      zmin: 0,\n      zmax: 10,\n      x: months.slice(2, 13),\n      y: roles.reverse(),\n      z: gap_desire_over_time.reverse(),\n      type: \"heatmap\",\n    },\n  ];\n  const config = {\n    displayModeBar: false,\n  };\n  const layout = {\n    height: row_height * roles.length + heatmap_base,\n    margin: {\n      t: 5,\n    },\n    pad: 0,\n  };\n\n  if (typeof plotly !== \"undefined\" && plotly) {\n    try {\n      await plotly.newPlot(div, data, layout, config);\n    } catch (error) {\n      console.error(\"Error creating rest time chart:\", error);\n    }\n  } else {\n    console.warn(\"Plotly is not defined, skipping chart rendering\");\n  }\n}\n\n/**\n * Loads content for pages with auto-generated sunburst from DOM structure\n * @param rootName The name for the root node of the sunburst\n * @param sunburstAdder Function to add sunburst (default: add_sunburst_from_dom)\n * @param promptsAdder Function to add random prompts (default: add_random_prompts)\n * @param postsAdder Function to add blog posts (default: add_imported_blog_posts)\n * @param eulogyAdder Function to add eulogy roles (default: add_eulogy_roles)\n * @param randomizerAppender Function to append randomizer (default: append_randomizer_div)\n */\nexport function load_auto_sunburst(\n  rootName = \"Topics\",\n  sunburstAdder = add_sunburst_from_dom,\n  promptsAdder = add_random_prompts,\n  postsAdder = add_imported_blog_posts,\n  eulogyAdder = add_eulogy_roles,\n  randomizerAppender = append_randomizer_div,\n) {\n  try {\n    sunburstAdder(\"sunburst\", \"sunburst_text\", rootName);\n    promptsAdder();\n    postsAdder(); // has a random achievement post\n    eulogyAdder(\"#random-eulogy-role\");\n    randomizerAppender(\"#random-blog-posts\", async () => await make_random_post_html());\n  } catch (error) {\n    console.error(\"Error loading auto-generated sunburst:\", error);\n  }\n}\n\n// Export utility functions for testing\nexport const UT = {\n  SevenHabits,\n  ThingsIEnjoy,\n};\n","// Import dependencies\nimport { get_link_info, random_from_list } from \"./shared\";\n\n// For autocomplete, safely access the window properties\n// This makes it more testable\nlet autocomplete: any;\nlet getAlgoliaResults: any;\nif (typeof window !== \"undefined\" && window[\"@algolia/autocomplete-js\"]) {\n  const algoliaAutocomplete = window[\"@algolia/autocomplete-js\"];\n  autocomplete = algoliaAutocomplete.autocomplete;\n  getAlgoliaResults = algoliaAutocomplete.getAlgoliaResults;\n}\n\n// Adding a query parameter.\n// import instantsearch from \"algoliasearch\";\n\nexport const search_placeholder_text = \"Search Igor's Musings ...\";\n\n/**\n * Helper function to escape HTML to prevent XSS\n */\nfunction escapeHtml(text: string): string {\n  const div = document.createElement(\"div\");\n  div.textContent = text || \"\";\n  return div.innerHTML;\n}\n\n/**\n * Helper function to validate URLs\n */\nfunction isValidUrl(url: string): boolean {\n  if (!url) return false;\n\n  // Allow relative URLs (starting with /)\n  if (url.startsWith(\"/\")) {\n    return true;\n  }\n\n  // Allow well-formed absolute URLs\n  try {\n    const parsed = new URL(url);\n    return parsed.protocol === \"http:\" || parsed.protocol === \"https:\";\n  } catch {\n    return false;\n  }\n}\n\n/**\n * Gets a query parameter value from a URL\n * @param name Parameter name\n * @param url URL to extract from (defaults to window.location.href)\n * @returns Parameter value, empty string if parameter exists with no value, or null if parameter doesn't exist\n */\nexport function getParameterByName(name: string, url?: string): string | null {\n  if (!url) url = window.location.href;\n  name = name.replace(/[[\\]\\\\]/g, \"\\\\$&\");\n  const regex = new RegExp(`[?&]${name}(=([^&#]*)|&|#|$)`);\n  const results = regex.exec(url);\n  if (!results) return null;\n  if (!results[2]) return \"\";\n  return decodeURIComponent(results[2].replace(/\\+/g, \" \"));\n}\n\n/**\n * Generates HTML for an Algolia search hit\n * @param hit Algolia search hit\n * @returns HTML string\n */\nexport function InstantSearchHitTemplate(hit) {\n  // https://www.algolia.com/doc/api-reference/widgets/infinite-hits/js/\n  try {\n    let url = hit.url;\n    if (hit.anchor) {\n      url += `#${hit.anchor}`;\n    }\n\n    // Validate URL before using it\n    if (!isValidUrl(url)) {\n      console.warn(\"Invalid URL skipped in InstantSearchHitTemplate:\", url);\n      return \"<div>Invalid result</div>\";\n    }\n\n    const highlighted = hit._highlightResult;\n\n    if (!highlighted) {\n      console.log(\"No Highlight\", hit);\n    }\n    const title = highlighted.title.value;\n    const content = highlighted?.content?.value ?? \"\";\n    // <section class=\"notepad-post-excerpt\"><p>${content}</p></section>\n\n    // Use data attribute instead of onclick for better security\n    const string_rep = `\n           <span data-url=\"${escapeHtml(url)}\" style=\"cursor: pointer;\">\n              <b> <a href=\"${escapeHtml(url)}\">${title}</a></b> <span>${content}</span>\n           </span>\n        `;\n    return string_rep;\n  } catch (err) {\n    console.log(\"Error in hitTemplate\", err, hit);\n  }\n  return \"invalid HTML\";\n}\n\ndeclare function instantsearch(l: any): any;\ndeclare function algoliasearch(l: any, l2: any): any;\n\n/**\n * Creates an Algolia InstantSearch instance\n * @param appid Algolia app ID\n * @param search_api_key Algolia search API key\n * @param index_name Algolia index name\n * @param initial_query Initial search query\n * @returns InstantSearch instance\n */\nexport function CreateSearch(appid, search_api_key, index_name, initial_query) {\n  // Instanciating InstantSearch.js with Algolia credentials\n  const searchClient = algoliasearch(appid, search_api_key);\n  const search = instantsearch({\n    searchClient: searchClient,\n    indexName: index_name,\n    searchParameters: {\n      query: initial_query,\n    },\n  });\n\n  // Adding searchbar and results widgets\n  search.addWidget(\n    // @ts-ignore:TS2339\n    instantsearch.widgets.searchBox({\n      container: \"#search-box\",\n      placeholder: search_placeholder_text,\n      poweredBy: true, // This is required if you're on the free Community plan\n      showSubmit: false,\n      showReset: false,\n      showLoadingIndicator: false,\n    }),\n  );\n\n  search.addWidget(\n    // @ts-ignore:TS2339\n    instantsearch.widgets.infiniteHits({\n      container: \"#search-hits\",\n      templates: {\n        item: InstantSearchHitTemplate,\n      },\n      item({ item }) {\n        return `Result: ${item.name}`;\n      },\n    }),\n  );\n\n  return search;\n}\n\n// Copied from the docs, but this isn't working for me.\nexport function AutoCompleteHitTemplateWithComponentDoesNotWork({ item, components, createElement, fragments }) {\n  console.log(item);\n  return components.Highlight({ hit: item });\n}\n\n// Algolia uses some PREACT thing, which this project does not support\n// Reach way into algolia and build the HTML manually\nexport function AutoCompleteHitTemplate({ item, createElement }) {\n  // https://www.algolia.com/doc/api-reference/widgets/infinite-hits/js/\n  // Note: InstantSearchHitTemplate now includes URL validation and HTML escaping for security\n  return createElement(\"div\", {\n    dangerouslySetInnerHTML: {\n      __html: InstantSearchHitTemplate(item),\n    },\n  });\n}\n\n/**\n * Gets a random post from the backlinks\n * @returns Random post with title, URL, and description\n */\nexport async function get_random_post() {\n  const startTime = performance.now();\n  const all_url_info = await get_link_info();\n  const loadTime = performance.now() - startTime;\n  console.log(`  üìä [get_random_post] Loaded links in ${loadTime.toFixed(0)}ms`);\n\n  //  Yuk, find a clearere way to do this\n  const all_pages = Object.entries(all_url_info) // returns a list of [url, info]\n    .map((e) => e[1]);\n  const random_post = random_from_list(all_pages);\n  const ret = {\n    title: random_post.title,\n    url: random_post.url,\n    description: random_post.description,\n  };\n  return ret;\n}\n\n/**\n * Gets multiple random posts efficiently\n * @param count Number of random posts to return\n * @returns Array of random posts\n */\nexport async function get_random_posts_batch(count = 4) {\n  const startTime = performance.now();\n  const all_url_info = await get_link_info();\n  const loadTime = performance.now() - startTime;\n  console.log(`  üìä [get_random_posts_batch] Loaded links once in ${loadTime.toFixed(0)}ms`);\n\n  const all_pages = Object.entries(all_url_info).map((e) => e[1]);\n  const results = [];\n  const usedIndices = new Set();\n\n  // Get unique random posts\n  while (results.length < count && results.length < all_pages.length) {\n    const randomIndex = Math.floor(Math.random() * all_pages.length);\n    if (!usedIndices.has(randomIndex)) {\n      usedIndices.add(randomIndex);\n      const post = all_pages[randomIndex];\n      results.push({\n        title: post.title,\n        url: post.url,\n        description: post.description,\n      });\n    }\n  }\n\n  return results;\n}\n\n/**\n * Gets recent posts from the back-links.json file\n * Returns the specified number of most recently modified posts\n * @param count Number of posts to return\n */\nexport async function get_recent_posts(count = 4) {\n  try {\n    const startTime = performance.now();\n    const all_url_info = await get_link_info();\n    const loadTime = performance.now() - startTime;\n    console.log(`  üìä [get_recent_posts] Loaded links in ${loadTime.toFixed(0)}ms`);\n\n    // Convert to array of pages for easier processing\n    const pages = Object.entries(all_url_info).map(([url, metadata]) => ({\n      url,\n      title: metadata.title || url,\n      description: metadata.description || \"\",\n      doc_size: metadata.doc_size || 0,\n      last_modified: metadata.last_modified || \"\",\n    }));\n\n    // Filter out pages that are likely redirects (these have empty descriptions and titles)\n    const realPages = pages.filter(\n      (page) => page.description && page.description.trim() !== \"\" && page.title && page.title.trim() !== \"\",\n    );\n\n    // Sort by last_modified date (newest first)\n    const sortedPages = realPages.sort((a, b) => {\n      if (a.last_modified && b.last_modified) {\n        return new Date(b.last_modified).getTime() - new Date(a.last_modified).getTime();\n      }\n      // Fallback to doc_size if last_modified is not available\n      return b.doc_size - a.doc_size;\n    });\n\n    // Take the top N most recent posts\n    return sortedPages.slice(0, count);\n  } catch (error) {\n    console.error(\"‚ùå Error loading recent posts:\", error);\n    return [];\n  }\n}\n\n/**\n * Gets random posts for search results\n * @param count Number of random posts to return (default: 3)\n */\nexport async function GetRandomSearchResults(count = 3) {\n  return {\n    sourceId: \"random_posts\",\n    async getItems() {\n      const sized_array = new Array(count).join(\"_\").split(\"_\");\n      const random_posts = await Promise.all(\n        sized_array.map(async (e) => {\n          try {\n            return await get_random_post();\n          } catch (error) {\n            console.error(\"Error getting random post:\", error);\n            return { url: \"\", title: \"Error\", description: \"Failed to load post\" };\n          }\n        }),\n      );\n      return random_posts;\n    },\n    getItemUrl({ item }) {\n      const ret = item.url;\n      return ret;\n    },\n    templates: {\n      item({ item, createElement }) {\n        // Validate URL before using it\n        if (!isValidUrl(item.url)) {\n          console.warn(\"Invalid URL skipped in GetRandomSearchResults:\", item.url);\n          return createElement(\"div\", {\n            dangerouslySetInnerHTML: {\n              __html: \"<div>Invalid result</div>\",\n            },\n          });\n        }\n\n        return createElement(\"div\", {\n          dangerouslySetInnerHTML: {\n            __html: `\n            <span data-url=\"${escapeHtml(item.url)}\" style=\"cursor: pointer;\">\n           <b> <a href=\"${escapeHtml(item.url)}\">${escapeHtml(item.title)}</a></b>\n            <span>${escapeHtml(item.description)}</span>\n            </span>\n            `,\n          },\n        });\n      },\n      header({ createElement }) {\n        return createElement(\"div\", {\n          dangerouslySetInnerHTML: {\n            __html: \"<i style='color:grey'>Random posts ...</i>\",\n          },\n        });\n      },\n    },\n  };\n}\n\n/**\n * Gets recent posts for search results\n * @param count Number of recent posts to return (default: 4)\n */\nexport async function GetRecentSearchResults(count = 4) {\n  return {\n    sourceId: \"recent_posts\",\n    async getItems() {\n      const recentPosts = await get_recent_posts(count);\n      return recentPosts;\n    },\n    getItemUrl({ item }) {\n      const ret = item.url;\n      return ret;\n    },\n    templates: {\n      item({ item, createElement }) {\n        // Validate URL before using it\n        if (!isValidUrl(item.url)) {\n          console.warn(\"Invalid URL skipped in GetRecentSearchResults:\", item.url);\n          return createElement(\"div\", {\n            dangerouslySetInnerHTML: {\n              __html: \"<div>Invalid result</div>\",\n            },\n          });\n        }\n\n        return createElement(\"div\", {\n          dangerouslySetInnerHTML: {\n            __html: `\n            <span data-url=\"${escapeHtml(item.url)}\" style=\"cursor: pointer;\">\n           <b> <a href=\"${escapeHtml(item.url)}\">${escapeHtml(item.title)}</a></b>\n            <span>${escapeHtml(item.description)}</span>\n            </span>\n            `,\n          },\n        });\n      },\n      header({ createElement }) {\n        return createElement(\"div\", {\n          dangerouslySetInnerHTML: {\n            __html: \"<i style='color:grey'>Recent posts ...</i>\",\n          },\n        });\n      },\n    },\n  };\n}\n\n/**\n * Gets featured posts from Algolia search\n * @param searchClient Algolia search client\n * @param index_name Index name to search\n * @param query Search query\n * @param hitsPerPage Number of results to return (default: 3)\n * @param includeFamilyJournal Whether to include family journal posts\n */\nexport function GetAlgoliaResults(searchClient, index_name, query, hitsPerPage = 3, includeFamilyJournal = false) {\n  // By default don't include family journal.\n  let filter = \"NOT tags:family-journal\";\n  if (includeFamilyJournal) {\n    filter = \"\";\n  }\n\n  return {\n    sourceId: \"featured_posts\",\n    getItems() {\n      if (!getAlgoliaResults) {\n        console.error(\"getAlgoliaResults is not defined\");\n        return [];\n      }\n      return getAlgoliaResults({\n        searchClient,\n        queries: [\n          {\n            indexName: index_name,\n            query,\n            filters: filter,\n            params: {\n              hitsPerPage: hitsPerPage,\n              highlightPreTag: \"<span style='background:yellow'>\",\n              highlightPostTag: \"</span>\",\n            },\n          },\n        ],\n      });\n    },\n    templates: {\n      item: AutoCompleteHitTemplate,\n      header({ createElement }) {\n        return createElement(\"div\", {\n          dangerouslySetInnerHTML: {\n            __html: \"<i style='color:grey'>Featured posts ...</i>\",\n          },\n        });\n      },\n    },\n    getItemUrl({ item }) {\n      let url = item.url;\n      if (item.anchor) {\n        url += `#${item.anchor}`;\n      }\n      const ret = url;\n      return ret;\n    },\n  };\n}\n\n/**\n * Creates an autocomplete search component\n * @param appid Algolia app ID\n * @param search_api_key Algolia search API key\n * @param index_name Algolia index name\n * @param autocomplete_id ID of the autocomplete element\n * @param includeFamilyJournal Whether to include family journal posts\n * @param featuredCount Number of featured posts to show (default: 3)\n * @param recentCount Number of recent posts to show (default: 4)\n * @param randomCount Number of random posts to show (default: 3)\n */\nexport async function CreateAutoComplete(\n  appid,\n  search_api_key,\n  index_name,\n  autocomplete_id,\n  includeFamilyJournal,\n  featuredCount = 3,\n  recentCount = 4,\n  randomCount = 3,\n) {\n  if (!autocomplete) {\n    console.error(\"Autocomplete is not defined\");\n    return;\n  }\n\n  const searchClient = algoliasearch(appid, search_api_key);\n  const randomSearchResults = await GetRandomSearchResults(randomCount);\n  const recentSearchResults = await GetRecentSearchResults(recentCount);\n\n  function GetSources({ query }) {\n    const isEmptySearch = query.length === 0;\n    if (isEmptySearch) {\n      // Searching for a space gives nice default results, so when no results search for that ...\n      query = \" \";\n    }\n\n    // Get featured posts (from Algolia search)\n    const featuredPosts = GetAlgoliaResults(\n      searchClient,\n      index_name,\n      query,\n      isEmptySearch ? featuredCount : 10, // Show N featured posts when empty, more when searching\n      includeFamilyJournal,\n    );\n\n    // For empty search, show featured, recent, and random posts\n    // For actual search, just show search results\n    if (isEmptySearch) {\n      return [featuredPosts, recentSearchResults, randomSearchResults];\n    }\n    return [featuredPosts];\n  }\n\n  // Make sure we have the element\n  // autocomplete_id can be either '#id' or just 'id'\n  const elementId = autocomplete_id.startsWith(\"#\") ? autocomplete_id : `#${autocomplete_id}`;\n  if ($(elementId).length === 0) {\n    console.log(\"No autocomplete element found\", \"autocomplete_id\", autocomplete_id);\n    return;\n  }\n\n  // Setup Auto Complete Stuff\n  return autocomplete({\n    container: elementId,\n    placeholder: search_placeholder_text,\n    getSources: GetSources,\n    debug: false,\n    openOnFocus: true,\n    detachedMediaQuery: \"\",\n  });\n}\n","/**\n * Main JavaScript Entry Point\n *\n * This file serves as the single entry point for all JavaScript functionality\n * on the blog. It imports and initializes all necessary modules.\n */\n\n// Import main functionality\nimport { load_globals } from \"./main\";\n// Import page-loader functionality\nimport {\n  load_7_habits,\n  load_auto_sunburst,\n  load_balance,\n  load_enjoy2,\n  load_ig66,\n  load_random_eulogy,\n  makePostPreviewHTML,\n  make_random_post_html,\n} from \"./page-loader\";\n// Import random-prompter functionality\nimport { TreeNode, add_random_prompts, add_sunburst, add_sunburst_from_dom } from \"./random-prompter\";\n\n// Import recent posts functionality\nimport { initRecentAllPosts } from \"./recent\";\n// Import search functionality\nimport { CreateAutoComplete, get_random_post, get_random_posts_batch, get_recent_posts } from \"./search\";\n// Import shared utilities\nimport {\n  type IURLInfo,\n  type IURLInfoMap,\n  MakeBackLinkHTML,\n  append_randomizer_div,\n  defer,\n  get_link_info,\n  get_random_page_url,\n  random_from_list,\n  shuffle,\n} from \"./shared\";\n\n// Declare global variables from external libraries\ndeclare let $: {\n  (\n    selector: string,\n  ): {\n    ready: (fn: () => void) => void;\n    length: number;\n    focus: () => void;\n  };\n  (\n    document: Document,\n  ): {\n    ready: (fn: () => void) => void;\n  };\n};\ndeclare let Mousetrap: {\n  bind: (key: string, callback: () => void) => void;\n};\n\n// Main initialization\n$(document).ready(() => {\n  // Initialize main functionality\n  const tocExpand = true;\n\n  // Call the global initialization function from main.ts\n  defer(load_globals);\n\n  // Setup event handlers\n  const setupKeyboardShortcuts = () => {\n    if (typeof Mousetrap !== \"undefined\") {\n      Mousetrap.bind(\"s\", () => focusSearch());\n      // Add other keyboard shortcuts as needed\n    }\n  };\n\n  const focusSearch = () => {\n    const searchInput = $(\"#search-box\");\n    if (searchInput.length > 0) {\n      searchInput.focus();\n    }\n  };\n\n  // Initialize components\n  setupKeyboardShortcuts();\n  initializeTOC();\n  initializeSearch();\n\n  // Example usage of shared utilities\n  const items = [\"item1\", \"item2\", \"item3\"];\n  console.log(\"Random item:\", random_from_list(items));\n  console.log(\"Shuffled items:\", shuffle([...items]));\n\n  // Initialize link loading\n  get_link_info().then((links) => {\n    console.log(\"Links loaded, count:\", Object.keys(links).length);\n  });\n\n  // Log successful initialization\n  console.log(\"Blog JavaScript initialized\");\n});\n\n// Initialize TOC\nfunction initializeTOC() {\n  const tocElement = $(\"#toc-content\");\n  if (tocElement.length > 0) {\n    // TOC initialization code\n    console.log(\"TOC initialized\");\n  }\n}\n\n// Initialize search\nfunction initializeSearch() {\n  const searchElement = $(\"#search-box\");\n  if (searchElement.length > 0) {\n    // Search initialization code\n    console.log(\"Search initialized\");\n  }\n}\n\n// Export shared utilities and main functions for potential direct use\nexport {\n  random_from_list,\n  shuffle,\n  append_randomizer_div,\n  defer,\n  get_link_info,\n  get_random_page_url,\n  // Export the interface types\n  type IURLInfo,\n  type IURLInfoMap,\n  load_globals,\n  MakeBackLinkHTML,\n  CreateAutoComplete,\n  get_random_post,\n  get_recent_posts,\n  get_random_posts_batch,\n  // Recent posts export\n  initRecentAllPosts,\n  // Random prompter exports\n  add_random_prompts,\n  add_sunburst,\n  add_sunburst_from_dom,\n  TreeNode,\n  // Page loader exports\n  load_enjoy2,\n  load_7_habits,\n  load_auto_sunburst,\n  makePostPreviewHTML,\n  make_random_post_html,\n  load_ig66,\n  load_balance,\n  load_random_eulogy,\n};\n"],"names":["MakeBackLinkHTML","url_info","random_from_list","list","shuffle","array","currentIndex","randomIndex","defer","fn","functionName","name","append_randomizer_div","parent_id","random_html_factory","$parent","html","new_element","event","cached_link_info","get_link_info","url","isProd","backlinks_url","e","get_random_page_url","linkInfo","urls","isExcluded","path","hasExcludedPattern","pattern","error","fetchBacklinksData","convertToPages","urlInfoMap","metadata","filterRealPages","pages","page","sortPagesByDate","a","b","getProcessedPages","realPages","groupPagesByMonthYear","groupedPages","date","monthYear","generateGroupedPagesHTML","createToggleSection","remainingHtml","count","generateStyles","setupToggleEventListener","toggleId","contentId","doc","toggleElement","contentElement","iconElement","generateRecentPostsHTML","initialPostsCount","initialPages","remainingPages","remainingGroupedPages","updateRecentPosts","containerId","recentContainer","sortedPages","initRecentAllPosts","getRecentPages","generateRecentPagesHTML","recentPages","recentPostsContainer","initRecentPosts","node_for_url","exactMatch","p","normalizedUrl","build_links","links","outgoingLinks","incomingLinks","combinedLinks","targetUrl","g_pages","link","build_graph_data","visible_pages","visible_links","newly_visible_pages","l","node","TextLabelNodeCanvas","ctx","globalScale","outgoingCount","expandedText","label","fontSize","bckgDimensions","n","TextLabelNodePointerAreaPaint","color","g_last_detail_node","Graph","center_on_node","update_detail","detail","open_goto_control","collapse_all_except_active","initializeGraph","slug","initial_expanded_url","initialNode","centerControl","gotoControl","collapseControl","getCurrentBranch","branch","getCurrentPR","pr","getCurrentPort","initDevInfo","port","devInfoElement","infoContent","prUrl","currentPaddingTop","DEFAULT_OPTIONS","createCopyLinkIcon","options","icon","createGitHubIssueIcon","sheet","faIcon","createIssuePopup","headerId","headerText","popup","content","header","h4","closeBtn","body","titleLabel","titleInput","descLabel","descTextarea","buttonsDiv","submitBtn","cancelBtn","hintDiv","small","showIssuePopup","rect","scrollTop","scrollLeft","hideIssuePopup","textarea","showCopiedTooltip","element","duration","existingTooltip","tooltip","buildBreadcrumbFrom","readablePageName","headerHierarchy","tagName","headerLevel","currentHeaderText","prevElement","foundHeaders","seenLevels","prevTagName","prevLevel","prevHeaderText","h","breadcrumb","limitedHierarchy","transformUrl","transformedUrl","urlObj","pathname","anchor","shareOrCopyHeaderLink","currentUrl","anchorUrl","tinyUrl","shareTitle","previewText","getPreviewText","breadcrumbFrom","shareText","isMobile","shareError","clipboardText","textArea","fallbackError","getOrCreateHeaderId","id","uniqueId","counter","getFirstParagraphAfterHeader","nextElement","text","listItems","itemTexts","totalLength","li","combinedText","truncateText","maxLength","truncated","lastSpace","paragraphText","textParts","charCount","contentSelectors","selector","contentArea","firstParagraph","createGitHubIssueUrl","customTitle","customDescription","pagePath","metaTag","sourceFile","repoUrl","formattedTitle","issueTitle","description","issueBodyContent","issueBody","headerCleanupFunctions","headerPopups","trackedHeaders","getOrCreatePopup","setupPopupEventHandlers","cleanupFunctions","closeHandler","cancelHandler","submitIssue","commentTextarea","issueUrl","handleKeydown","existingCleanup","addCopyLinkToHeader","copyIcon","githubIcon","shareClickHandler","keyboardHandler","githubClickHandler","handleOutsideClick","timeoutId","mouseEnterHandler","mouseLeaveHandler","initHeaderCopyLinks","customOptions","allHeaders","addHeaderCopyLinkStyles","styleId","style","isHeaderCopyLinksInitialized","enableHeaderCopyLinks","MAX_RETRY_ATTEMPTS","RETRY_DELAY_MS","MAX_RETRY_TIME_MS","enableImageZoom","retryCount","images","processedCount","img","index","imageElement","lightbox","tocExpand","checkExpandToggle","toc","toggle","PROD_ORIGIN","DEV_ORIGIN_KEY","isProduction","isDevOrigin","origin","host","saveDevOriginFromReferrer","referrerOrigin","SwapProdAndTest","devOrigin","ForceShowRightSideBar","mainContent","tocDropUp","generateToc","showPinToc","target","tocMenu","backToTop","gotoBottom","forceSideBar","AddLinksToPage","allUrls","page_path","backlinks","frontlinks","link_parent_location","incoming_location","sort_descending_by_size","backlink","clean_front_links","frontlink","outgoing_location","graph_location","stripped_page_path","make_html_summary_link","make_html_summary_link_error","title","attribution","AddSummarysToPage","backLinks","summary_links","raw_link","ref","add_link_loader","globalFlag","get_back_links","cached_back_links","backlinksJson","search","keyboard_shortcut_loader","mouseTrap","shortcutHelp","replacePlaceholdersWithLists","listReplacements","placeholderText","placeholderLink","listClone","buildListReplacementMap","replacements","lists","firstListItem","firstItemText","listId","replaceListPlaceholdersInTables","load_globals","html_for_blogpost","post","item","title_href","monthNames","thumbnail_url","published_date","excerptDisplayText","get_achievement_posts","imported_posts","get_recent_posts","ProcessImports","posts","random_div","achievement_div","random_recent","add_imported_blog_posts","html_for_role","role","role_file_name","voices","ProcessEulogy","div","roles","add_eulogy_roles","TreeNode","value","children","add_random_prompts","categoryToPromptsProvider","category_to_prompts","renderer","render_prompt_for_category","map_category_to_prompts","category","prompts_for_category","jQueryProvider","randomizerAppender","get_random_prompt_html","starting_node","current_category","breadth_first_walk","Q","current","parent","child","tree_to_plotly_data_format","root","names_parent_names","category_to_prompts_text","mapProvider","map","k","v","_index","random_prompt_for_label","tree_node","map_node_to_prompts","result","_parent","clicked_node","all_prompts","hasWithoutEmoji","hasWithEmoji","prompt","add_sunburst","plot_element_id","random_text_div_id","plotlyProvider","sunburst_tree_flat","sunburst_data","sunburst_layout","config","set_random_prompt_text","plotElement","eventData","extract_tree_from_dom","rootName","containerSelector","h2Elements","rootChildren","h2Element","h2","h2Text","h2Children","currentElement","h3Text","add_sunburst_from_dom","tree","SevenHabits","ThingsIEnjoy","health","magic","hobbies","relationships","joy","makePostPreviewHTML","filename","make_random_post_html","linkInfoProvider","randomSelector","all_url_info","all_pages","random_post","load_random_eulogy","element1","element2","element3","eulogyLoader","load_enjoy2","sunburstAdder","promptsAdder","postsAdder","eulogyAdder","load_7_habits","load_ig66","load_balance","restChartMaker","make_balance_chart_by_desired_time_rest","workChartMaker","make_balance_chart_by_work","radarMapMaker","make_radar_map","months","row_height","heatmap_base","ideal_color","plotly","data","layout","color_scale","gap_desire_over_time","load_auto_sunburst","autocomplete","getAlgoliaResults","algoliaAutocomplete","search_placeholder_text","escapeHtml","isValidUrl","parsed","InstantSearchHitTemplate","hit","highlighted","err","AutoCompleteHitTemplate","createElement","get_random_post","startTime","loadTime","get_random_posts_batch","results","usedIndices","GetRandomSearchResults","sized_array","GetRecentSearchResults","GetAlgoliaResults","searchClient","index_name","query","hitsPerPage","includeFamilyJournal","filter","CreateAutoComplete","appid","search_api_key","autocomplete_id","featuredCount","recentCount","randomCount","randomSearchResults","recentSearchResults","GetSources","isEmptySearch","featuredPosts","elementId","setupKeyboardShortcuts","focusSearch","searchInput","initializeTOC","initializeSearch","items"],"mappings":"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"}
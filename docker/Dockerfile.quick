FROM ubuntu:24.04

ENV DEBIAN_FRONTEND=noninteractive
ENV SHELL=/bin/bash

# Create claude user
RUN useradd -m -s /bin/bash claude && \
    echo "claude ALL=(ALL) NOPASSWD:ALL" >> /etc/sudoers

# Install minimal essentials for testing
RUN apt-get update && apt-get install -y \
    git curl wget sudo \
    nodejs npm \
    python3 python3-pip \
    gh \
    vim \
    && apt-get clean && \
    rm -rf /var/lib/apt/lists/*

USER claude
WORKDIR /workspace

# Copy scripts
COPY --chown=claude:claude scripts/entrypoint.sh /home/claude/scripts/entrypoint.sh
RUN chmod +x /home/claude/scripts/entrypoint.sh

ENTRYPOINT ["/home/claude/scripts/entrypoint.sh"]
CMD ["/bin/bash"]